# easygpt

This readme is generated by this program. `easygpt -p '以下を英訳せよ' ./readme.md --postfix "_en"`

A program that uses the chatgpt API to process text files in bulk.  
You can do various things depending on how you use it, such as translation and adding comments to the source code.  

## install

```sh
go install github.com/xcd0/easygpt@latest
```

## Preparation

Set your OpenAI API key to the environment variable `OPENAI_API_KEY`.  
The API key below is an invalid API key for example purposes, so issue your own valid API key and set it.  
API keys can be issued from https://platform.openai.com/account/api-keys.  
Set the issued API key in `.bashrc` or similar.
```sh
$ export OPENAI_API_KEY=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
$ echo export OPENAI_API_KEY=$OPENAI_API_KEY >> .bashrc
```

## Example 1: Getting output by giving a string to the AI

If the API key is specified in the environment variable, you can execute it directly from the command line.

```sh
$ easygpt -i "Say this is test."
this is test.
$ easygpt -i 自己紹介してください。
こんにちは、私はAIです。私はOpenAIが開発した自然言語処理モデルです。私の目的は、ユーザーが質問や要求をすると、最善の回答や応答を提供することです。私は様々なトピックについての情報を持っており、文法やスタイルの修正も行うことができます。どのようにお手伝いできますか？
```

## Example 2: D&D (Drag and Drop)

Process all the given files and folders in bulk by giving them to the AI.  
By selecting files and folders and dragging and dropping them on the executable file, you can process the included files as text with the AI.  
* Intended for use in a GUI.
* The output is saved with the input file name appended with `_easygpt_output`.
* The behavior can be changed by the configuration file described below.
	* For this usage, the following settings in the configuration file are ignored:
		* input-dir
		* output-dir
		* extension

## Example 3: Bulk processing of multiple files

Process multiple text files in the specified directory in bulk with the AI.  
This is the main usage.  
This usage specifies the behavior with the configuration file.  
More detailed control can be achieved than Example 2.  

## About the configuration file

Generate a template for the configuration file and edit it to create the configuration file.  

| key          | Required | Description                  |
|--------------|--------|-----------------------|
| input-dir    | Required   | Input directory.<br>A directory to store the files you want to give to the AI. |
| output-dir   | Required   | Output directory.<br>A directory that will be created to have the same directory structure as the input directory.|
| apikey       | Optional   | Specify the API key. Not necessary if specified in the environment variable.<br>If specified in the configuration file, it will override the specification in the environment variable.|
| prompt       | Optional   | The string specified here is prepended to the beginning of all input files.<br>Write down any instructions or support for the AI.|
| extension    | Optional   | Limit the input files with the specified extension in the input directory.<br> When this specification is empty, specified as *, or not specified, it is not limited by the extension.|
| concurrency  | Optional   | The number of concurrent executions. Be aware of the rate limit of the API.|
| temperature  | Optional   | Specify the AI's variable `temperature`. |
| move         | Optional   | Move successfully processed files to the specified directory.<br>It makes it easier to run again from the middle if it is interrupted due to an error or Ctrl-C. |
| tmp-dir      | Optional   | Basically, it is not necessary to specify. A directory to hold temporary files.|
| postfix      | Optional   | Basically, it is not necessary to specify. Specify it when you want to add a string to the end of the output file name.|
| ai-model     | Optional   | Basically, it is not necessary to specify. You can specify the AI model you want to use.|
| openai-url   | Optional   | Basically, it is not necessary to specify. You can specify the URL of the API.|


1. Generating a template.

There are many configurable items, so it is recommended to generate a template for the configuration file and edit it.  

The following command generates `eagygpt.hjson` in the current directory.  
```sh
$ easygpt --create-setting
```
`easygpt -c` is also fine.  


2. Editing the configuration file.
* Setting the API key
	* You can specify the API key in the configuration file. If you have set it in the environment variable `OPENAI_API_KEY`, it is not necessary.

* In the `prompt` part of the configuration file, write the string you want to give to the beginning of the input text file.  
   For example, if you want to translate an English text file, write `prompt: Please translate the following.`.  
   When you want to write multiple lines, separate them with `\n` or use the following heredoc format.  
   ```
   prompt:  
   '''  
   You can write multiple lines like this.  
   '''  
   ```
   For details, refer to the `Mulutiline Setting` in the [hjson documentation](https://hjson.github.io/syntax.html).

For other arguments, read the comments in the generated configuration file and write them as needed.  
Basically, `input-dir` and `output-dir` should be specified.

3. Placing the configuration file.

Basically, you just need to place `easygpt.hjson` in the current directory.  

The following specification is followed when searching for the configuration file.  

The default names of the configuration files are:  
* easygpt.hjson  
* .easygpt.hjson  
* .easygpt  
There are three types.  
If you want to use a configuration file with a different name, you can specify it with the `--setting` argument.  

The default locations for the configuration file are:  
* Current directory  
* Home directory  
* The same directory as the executable  
There are three places.  
The search for the configuration file is performed in this order.  
Therefore, if it exists in the current directory, the configuration file in the home directory will be ignored.  


## Configuration by command line arguments

If command line arguments are set, the values in the configuration file will be overwritten with the values in the command line arguments.  
For values set in the default path configuration file, the arguments can be omitted.  
Since there are many arguments that can be set, it is recommended to use a configuration file in most cases.  

Arguments can be in any order.  
For details about the arguments, refer to the help text output by `./easygpt --help`.  





## OSS libraries used

A copy of each OSS library's license is maintained in `./lisenses`.

* Argument parsing and help generation
	* [alexflint/go-arg](https://github.com/alexflint/go-arg)
		* BSD-2-Clause license
* Random string generation (does not have to be UUID)
	* [google/uuid](https://github.com/google/uuid)
		* BSD-3-Clause license
* Stack trace
	* [pkg/errors](https://github.com/pkg/errors)
		* BSD 2-Clause "Simplified" License
* Configuration file
	* [hjson/hjson-go](https://github.com/hjson/hjson-go)
		* MIT License
* Golang itself
	* [golang/go](https://github.com/golang/go)
		* BSD 3-Clause "New" or "Revised" License
* Fetching license files
	* [google/go-licenses](https://github.com/google/go-licenses)
		* Apache License 2.0
* Executable compression
	* [upx/upx](https://github.com/upx/upx)
		* GPL2+ or UPX LICENSE
			* https://upx.github.io/upx-license.html
		* The program is distributed without modification by compressing it with upx during make. The source code of upx is not included in the program.

## LICENSE

MIT License
