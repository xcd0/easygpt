## 13.2 自動寸法付け

自動寸法付けは、拘束不足のモデルに寸法を追加するプロセスです。
自動寸法付けは、自動拘束と似ていますが、論理的な制約ではなく値を持つ寸法を適用するために使用されます。
自動寸法付けは既存の制約と寸法を考慮し、過寸法のモデルにはなりません。

このセクションでは、自動寸法付けをサポートするDCMの関数と、それらをアプリケーションで使用する方法について説明します。
寸法を追加する前に、モデルに制約を追加することが推奨されます。

一般的に、モデルに一貫した寸法セットを適用する方法は多岐にわたります。
通常、N個の拘束不足の図形を持つモデルでは、N個の寸法が必要であり、それらを適用する方法はおおよそN2通りあります。

アプリケーションは、DCMに対して試すべき寸法のクラスを指定することで、可能な寸法の総数を減らすことができます。
これは、以下のオプションの組み合わせを使用して行われます。

- どのタイプの図形間に寸法を付けるか。
- どのタイプの寸法を使用するか。
- 寸法を付ける特定の図形の配列。
この配列内の図形間に寸法がある場合のみ、寸法が試されます。
- 特定の図形のペア間に寸法を付ける。

寸法を適用するための自由度がないため、一部の寸法は拒否される場合があります。

これが行われた後でも、寸法を多くの異なる組み合わせで適用することができます。
繰り返し可能な結果を得るために、DCMは寸法を順序付けて並べ替えます。
その後、各寸法が順番に試され、モデルに適用できるかどうかを確認します。適用できる場合、アプリケーションにはこの寸法をモデルに追加するかどうかの選択肢が与えられます。適用できない場合は破棄されます。

寸法の並べ替え順序は、重みによって決定されます。
DCMは、各寸法に使用する重みをアプリケーションに問い合わせます。
アプリケーションが異なる重みを指定しない場合、DCMは組み込みのデフォルト値を使用します。
アプリケーションが0未満の重みを返す場合、DCMはこれを無視し、代わりに組み込みのデフォルト値を使用します。

寸法を特定する際、DCMはすべての制約の順列を提供しません。
たとえば、図形Aから図形Bへの距離が提供される場合、BからAへの距離は提供しません。
ただし、角度の場合、DCM\_OPKEY\_AUTODIM\_ANGLESオプションのDCM\_OPVAL\_AUTODIM\_ANGLES\_ONE / DCM\_OPVAL\_AUTODIM\_ANGLES\_BOTHの値を使用して、これを変更し、DCMに両方の寸法を提供するようにすることができます。

一般的に、自動寸法付けは、1つの自由度を除去する寸法のみを追加しようとします。
たとえば、2つの幾何学的に平行な直線間に距離寸法を追加することは考慮されません。
直線が平行に保たれるように制約されている場合のみ、距離寸法の候補として考慮されます。
この制限のため、モデルを自動拘束関数を使用して初期に制約することが常に推奨されます。これにより、自動寸法関数を使用する前に自動的に平行制約を適用することができます。

現在、自動寸法付けには2つのインターフェース関数があります。
詳細については、セクション[16.11.2 自動寸法付け - 寸法を自動生成する](16.11._Autodimensioning_and_autoconstraining.md)を参照してください。

DCM関数：[add\_autodimension\_mask](16.11._Autodimensioning_and_autoconstraining.md)

フラスタム関数：[DCM\_autodim\_weight](17.10._Functions_for_constraint_deduction_and_autodimensioning.md)

### 13.2.1 解析ユーザーインターフェースにおける自動寸法付け

DCMには、未定義の図形に自動的に寸法を適用するための強力で柔軟な機能が含まれています。
これらは、Analyseユーザーインターフェースの「寸法...自動寸法...」および「低レベル自動寸法...」の2つのメニューで利用できます。

自動寸法付けのコマンドを使用すると、寸法が表示に追加されます。
Analyseでは、非常にシンプルなアルゴリズムが使用され、寸法を表示に配置する方法を決定しますが、その結果、寸法が互いに重なることがあります。
寸法の配置方法は、アプリケーションの責任です。

#### 13.2.1.1 自動寸法/自動拘束メニュー

解析メニューの自動寸法/自動拘束の「ブロック単数形」トグルは、新しい（バージョン68.0で導入された）自動寸法インターフェース機能における単数形構成の診断を有効にします。
このトグルがONの場合、モデルの特異性の度合いを増加させる寸法は拒否されます。
これにより、性能の著しい低下が生じる可能性があります。
このトグルがOFFの場合、解析は古い自動寸法アルゴリズムを使用し、したがって特異な寸法設定が発生する可能性があります。

#### 13.2.1.2 一般的な自動寸法設定

低レベルの自動寸法設定コマンドは、DCMインターフェース関数と非常に似た方法で動作します。
これらのコマンドは、アプリケーションの開発中に自動寸法設定のさまざまな実装を調査するために使用することができます。

このメニューでは、使用する寸法のタイプまたはタイプ、寸法を付ける図形のタイプ、および寸法設定のモードを制御するオプションを選択できます。
この情報は、関数add\_autodimension\_maskを呼び出すコマンドAdd selectionを使用してDCMに渡されます。
異なる選択肢でこの関数を複数回呼び出すことで、自動寸法設定のオプションを追加することができます。

必要なすべてのオプションが追加されたら、Autodimensionコマンドを使用してDCM関数autodimensionを呼び出すことができます。
これにより、add\_autodimension\_maskへの呼び出しで指定された寸法が検索され、適用されます。

最終的な寸法設定は、DCMが図形に寸法を追加しようとする順序にのみ依存します。
各寸法が試されると、DCMはモデルが過定義になるかどうかを判断し、次の寸法を試す前にモデルに追加するか破棄するかを決定します。
アプリケーションは、異なるオプションでautodimensionを繰り返し呼び出すことによって順序（およびしたがって最終的な寸法設定）を制御することができます。
ただし、単一の呼び出しで追加できる寸法がいくつかある可能性があり、その後、DCMはアプリケーションに各可能な寸法の重みを指定するように要求します。

Analyseは、各寸法の重みを決定し、DCMに返すことができます。
これは、寸法の試行順序を制御するために使用されます。
または、Equal weightコマンドをONに設定することもできます。
Analyseは、常に各寸法に同じ重みを返し、DCMに各寸法を試す順序を決定させます。

Analyseが使用する重みは、各寸法のいくつかの側面を考慮して決定されます。
以下にリストされているもので、与えられた順序が重要です。
たとえば、寸法の値よりも寸法のタイプの方が重要です。

- 寸法のタイプ、以下の順序で：

- 円の半径寸法（最も重い）
- 楕円の主半径寸法
- 楕円の副半径寸法
- 角度寸法
- 平行線間の距離寸法
- 線と点の間の距離寸法
- 他のタイプの図形間の距離寸法（最も軽い）

- 固定された図形。
固定された図形と固定されていない図形の間の寸法は、固定されていない図形との間の寸法よりも重いです。
- 寸法の値。
小さい値の寸法は、大きな値の寸法よりも重いです。

Analyseが2つ以上の寸法に同じ重みを返す場合、DCMは内部で選択された重みを使用して寸法をソートし、適用する順序を決定します。
これは、Equal weightコマンドがONの場合に常に必要です。
DCMが使用する重みは、次の方法でソートされて選択されます。最初のものが最も重いものです。

- 寸法のタイプに従ってソートする（順序：半径、主半径、副半径、角度、距離）。
- 寸法を付ける図形のタイプに従ってソートする。線が他の図形よりも優先されます。
- 図形が固定されているかどうかに従ってソートする。固定された図形が固定されていない図形よりも優先されます。
- 図形の位置に従ってソートする。
この最終段階は、他の条件が同じ場合に繰り返し可能な結果を与えるために使用されます。

#### 13.2.1.3 インテリジェントな自動寸法付け

Low level autodim...メニューのコマンドは、DCMインターフェースの使用方法をより明確に示すために意図的に低レベルに設定されています。
これらは、アプリケーションで洗練された自動寸法付け機能を開発する可能性を正確に示すものではありません。
Autodimension...メニューのコマンドは、洗練された自動寸法付け機能の実装例を示しています。
これらのコマンドは、DCMインターフェースのすべての機能にアクセスするわけではありません。
代わりに、一部のコマンドが典型的なモデルに寸法を自動的に適用するようになっています。

各コマンドの詳細は、Analyseユーザーガイドで説明されています。
ほとんどのコマンドは直感的に操作します。
より洗練されたコマンドの一部については、以下で説明します。

Ladderモード

Ladderモードコマンドを使用すると、Analyseがライン間の距離寸法を適用する際に返す重みを変更することができます。
通常、重みは上記にリストされたルールに従って見つけられます。
LadderモードがONの場合、ライン間の距離に対して返される重みが変更されます。
固定されたラインに寸法を付けることを優先する代わりに、Analyseは一方のラインを他方に投影したときに「重なり合う」かどうかに応じて重みを割り当てます。
これは、[図67：Ladderモードでの重みの割り当て](#_Ref420987760)で示されています。他の重みには影響しません。

![fig57_weight_allocation.bmp](../Resources/Images/2ddcm_manual/Autodimensioning.png)

図67：Ladderモードでの重みの割り当て

##### 13.2.1.3.2 プロファイルシーケンス

プロファイルシーケンスコマンドは、連続した直線と円弧のセットを表す図形に寸法を適用するための簡単な方法です。
コマンドは、以下の順序で選択した図形に対して次の操作を行います。

- 半径は、可能な場合にはすべての円弧に適用されます（つまり、適切な自由度がある場合）。
- 角度寸法は、共通の頂点で交差する直線またはブレンドがある直線の間に可能な場合に適用されます。
- 距離寸法は、平行に制約された直線の間に可能な場合に適用されます。

これは、同じ図形を選択して、Autodim半径、Autodim l-l角度、Autodim l-l距離コマンドを使用するのとまったく同じです。

このコマンドはすべての可能な寸法を試すわけではないため、選択した図形がまだ拘束不足である可能性があります。
必要な場合は、Autodim完全コマンドを使用して、選択した図形にさらなる寸法を追加することができます。

##### 13.2.1.3.3 モデルシーケンス

モデルシーケンスコマンドは、寸法をモデルに自動的に適用する方法の例として提供されています。
この操作のシーケンスは、さまざまなモデルに対して満足のいく寸法設定を提供することがわかっています。
ただし、アプリケーションは典型的なモデルデータで実験する必要があります。

このコマンドは、いくつかのステップに分解することができます。
各ステップでは、ジオメトリが選択され、特定のオプションで自動寸法が適用されます。
自動寸法はすべての可能な寸法を調べますが、利用可能な自由度がある場合にのみ追加されます。
各ステップで追加される実際の寸法は、Analyseによって返される重みに依存します。

操作のシーケンスは次のとおりです：

- 半径寸法が追加されます。
- 境界曲線を伝播して個々のプロファイルを選択し、アンダーコンストレインドジオメトリから開始します。
その後、プロファイルシーケンスコマンドが結果のプロファイルに使用されます。
これは、すべてのアンダーコンストレインドジオメトリが訪れるまで続けられます。
なお、これはプロファイルを使用する唯一のコマンドです。
- 平行に制約された2つの直線間に距離寸法が追加されます。
- 共通のジオメトリを持つ直線間に角度寸法が追加されます（Autodim l-l anglesコマンドと同様）。
- 共通のジオメトリを持たない直線間に角度寸法が追加されます。
- 無境界の直線上にある点が選択されます。
これらの点間に距離寸法が追加されます。
- 固定された直線から点への距離寸法が追加されますが、接触点は除かれます。
たとえば、接触点となっている直線と円が接触している場合、その点は選択されません。
- 固定された直線からすべての点への距離寸法が追加されます。接触点も含まれます。
- その他のすべての寸法が追加されます。

モデルシーケンスコマンドは、constraint\_balance関数を呼び出し、この関数が残りの自由度がないことを示すと終了します。
