9.4 依存評価パラメトリック曲線

依存拘束は、評価されたパラメトリック曲線が他のDCM図形および可能な限りDCM変数に依存していることをDCMに通知するために使用されます。
通常、評価されたパラメトリック曲線は、アプリケーションによって複数の図形から再計算されるため、複数の依存拘束が適用されます。

モデルに依存拘束が存在する場合、DCMはモデルが解かれるときにアプリケーションに評価されたパラメトリック曲線を更新するよう要求します。
詳細については、セクション[9.4.3 依存拘束を持つモデルの解決](#_Ref437669797)を参照してください。

依存評価パラメトリック曲線を使用する場合、DCMは依存関係が次のようになると仮定します。つまり、パラメトリック曲線の形状は、その定義図形の相対位置と定義変数の値にのみ依存するということです。
したがって、すべての定義図形が同じ量だけ変換される場合、DCMは依存するパラメトリック曲線も変換されると仮定します。
これは、アプリケーションが存在するすべての依存関係をDCMに通知する必要があることを意味します。

### 9.4.1 依存パラメトリック曲線への拘束

依存パラメトリック曲線とモデル内の他の図形の間には、拘束と寸法を追加することができます。
他の図形がパラメトリックの定義図形ではない場合、それらは[9.1.1 不連続定義](9.1._Overview_of_evaluated_parametric_curves.md)のセクションで説明されているように解釈されます。

また、依存パラメトリック曲線とその定義図形の間にも拘束を配置することができます。
DCMは依然としてアプリケーションに対してパラメトリックを定義図形から再生成することを期待します。
ただし、DCMはこれらの拘束を依存関係の性質の指標として使用します。
可能な場合、アプリケーションは依存曲線とその定義図形の間に固定されたp\_nodesを使用することで、DCMの解決手順をさらに簡素化するべきです。

典型的な依存パラメトリック曲線は、いくつかのDCMポイントの位置によって定義され、またその曲線上にも存在します（アプリケーションはこの曲線を補間スプラインとしてモデル化するかもしれません）。アプリケーションは、この曲線をパラメトリックとしてDCMに追加するために、ポイントに依存関係の拘束を使用してDCMに通知し、これらのポイントが移動するたびに曲線を再生成します。

最適なパフォーマンスのために、アプリケーションはポイントと曲線の間に一致する拘束も追加する必要があります。アプリケーションは、パラメトリック曲線を更新する際にこの制約を満たすことをDCMに期待します。
アプリケーションはまた、接線の拘束に対して正しいヘルプパラメータを指定する必要があります。
曲線に一定のパラメータ制限がある場合、一致制約のためにエンドポイントに固定パラメータノードを作成する必要があります。

一部の場合、DCMはこの情報を利用してモデルを正常に解決することができます。
一般的には、これにより寸法をパラメトリック曲線に配置する方法により柔軟性が生まれます。
この情報がないと、DCMはいくつかの過拘束だが整合したケースを処理するために必要な関係を推測することができません。

### 9.4.2 依存するパラメトリック曲線間の拘束

対称、一致、パターンの拘束は、2つのパラメトリック曲線間にも適用することができます。
これらの拘束は、パラメトリック曲線の形状や位置を変更するために使用されるものではありません。
代わりに、DCMは、曲線の形状を再生成する際に常に拘束が満たされていることをアプリケーションが保証するものとします。

これらのタイプの拘束は、2つの依存するパラメトリック曲線間にも配置することができます。
この場合、両方のパラメトリック曲線は、それぞれの定義図形に依存する方法が同じである必要があります。
また、アプリケーションは、パラメトリックが依存する対応する図形間に同じ拘束（つまり、対称、一致、またはパターン）を配置する必要があります。

例えば、アプリケーションが2つの依存するパラメトリック曲線間に一致の拘束を配置する場合、曲線の対応する定義図形間にも一致の拘束を配置する必要があります。

9.4.3 依存制約を持つモデルの解決

前述のように、DCMは依存制約を含むモデルに対して、修正された解決手順を使用します。
以下の手順が、各パラメトリック図形に対して使用されます。

- DCMは、パラメトリックに依存制約を持つすべての図形の位置を計算します。
- DCMは、アプリケーションに対して、定義図形の新しい位置を使用して、パラメトリック曲線の形状と位置を更新するように要求します。
- DCMは、更新されたパラメトリック曲線を使用して、モデルを解決し続けます。
パラメトリック曲線に制約されている他の図形も、この段階で計算されます。
- この手順は、各パラメトリック曲線に対して複数回発生する場合があります。

DCMがこの手順に従う解決手順を決定できない場合、パラメトリック曲線、その定義図形、および依存制約を過拘束としてマークします。
これは、定義図形の位置がパラメトリック曲線の位置に直接または間接的に依存する場合、常に発生します。

### 9.4.4 単純な依存制約

依存する図形を解決するためには、評価中にパラメトリック曲線を複数回再配置する必要がある場合があります。
特に、依存する図形が多い場合は、これが遅くなることがあります。
単純な依存制約は、完全な依存制約の代わりとして使用することができます。
パラメトリックが単純な依存制約を使用して定義されている場合、DCMは依存する図形を1回の再配置で解決できる解が見つかる場合にのみモデルを解決します。
これにより、評価が比較的高速に行われるようにしながら、アプリケーションはパラメトリック図形に対して単純な制約スキームをサポートすることができます。

### 9.4.5 依存評価パラメトリックジオメトリの実装

依存パラメトリックジオメトリを持つモデルでは、DCMとアプリケーションの両方が、パラメトリック曲線の定義を更新する必要があるジオメトリや変数にアクセスする必要があります。
モデルを解決するプロセス中、DCMは、アプリケーションに曲線の定義を更新するよう要求する必要がある場合に、Frustum関数DCM\_parametric\_regenerateを呼び出します。

パラメトリックを定義するジオメトリや変数の一部またはすべては、DCMによって内部的に変更されているかもしれませんが、これらの変更はまだFrustumを通じて出力されていません。
アプリケーションは、DCM関数transformを呼び出してジオメトリの変更点を見つけることができます。また、変数の現在の値は、DCM関数valueを呼び出すことで取得できます。
アプリケーションは、どのジオメトリや変数が変更されたかを知らないため、曲線の定義に関連する関数をすべて呼び出す必要があります。他のジオメトリには呼び出してはいけません。
返される変換は、ジオメトリの元の位置を基準とした相対的なものです。

ジオメトリや変数がどのように変更されたかを知った後、アプリケーションは適切にパラメトリック曲線の形状と位置を更新し、DCM\_parametric\_regenerateの呼び出しから戻ることができます。
注意：DCMから返される変換は、変換のサイズに関係なく適用する必要があります。
その後、パラメトリック曲線の形状と位置は、この関数が再度呼び出されるか、DCMが解決プロセスを完了するまで変更してはいけません。

複雑さは、アプリケーションがDCMがDCM\_transform関数を呼び出すまで、Frustumが呼び出されるたびに同じジオメトリの位置を返さなければならないということです。
アプリケーションがこれを達成する方法の1つは、すべての定義ジオメトリのコピーを作成することです。
パラメトリックはこれらのコピーから計算され、元のジオメトリはDCMがDCM\_transform関数を呼び出すときにのみ変更されます。
コピーされたジオメトリは、Frustum関数DCM\_parametric\_regenerateが呼び出されたときに更新されます。手順は以下の通りです：

パラメトリックを作成するとき：

定義ジオメトリと変数のコピーを作成する

パラメトリックの形状が計算されるときにこれらのコピーを使用する

Frustum関数DCM\_parametric\_regenerateが呼び出されたとき：

すべての定義ジオメトリに対して

      コピーされたジオメトリを元の位置に復元する

DCM関数transformを呼び出して「新しい」位置を取得する

      変換をコピーに適用する

すべての定義変数に対して

      DCM関数valueを呼び出して「新しい」値を取得する

      コピーされたジオメトリと変数の位置を使用してパラメトリックを更新する

Frustum関数DCM\_transformが呼び出されたとき：

ジオメトリを更新する

変換されるジオメトリがパラメトリックを定義するためにコピーされている場合

      コピーを更新する

すべてのコピーされたジオメトリと変数が更新された後にパラメトリックを更新する

関数DCM\_parametric\_regenerateは、モデル内のジオメトリが変更されない場合でも、単一の評価の過程で複数回呼び出される場合があります。
アプリケーションは、上記の手順に従うことが重要です。

曲線の形状と位置を変更するだけでなく、アプリケーションは曲線のパラメータの制限や、曲線の寸法のヘルプパラメータの値も変更することができます。

DCMは再生成されたパラメトリックに変換を出力することはありません。
再生成された曲線のすべての変更は、定義ジオメトリに変換を出力し、アプリケーションに再生成を要求することで行われます。
アプリケーションが再生成されたパラメトリックの変換を問い合わせる場合、単位変換が返されます。
