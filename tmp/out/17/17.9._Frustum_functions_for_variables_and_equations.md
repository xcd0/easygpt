## 17.9 変数と方程式のための台形関数

これらの関数は、add\_vやadd\_eを呼び出してDCMに変数や方程式が追加された場合にのみ呼び出されます。

### 17.9.1 DCM_variable_start_value - 変数の初期値を返す

void* av にアプリケーションポインタを指定してこの関数を呼び出します。ただし、この変数はどの寸法にも関連付けられていない単純な変数です。
アプリケーションは変数の初期値を返さなければなりません。
この値は、非線形方程式で発生する可能性のある複数の根を区別するために必要であり、また、拘束不足の状況で変数に値を与えるためにも必要です。

寸法に関連付けられた変数の場合、DCMは測定値を初期変数値として使用し、したがってこの関数は呼び出されません。

### 17.9.2 DCM\_variable\_angle\_value - 角度の値を返す

DCM\_variable\_angle\_value(void\* av, double\* val)関数は、アプリケーションポインタを使用して変数の角度の値を返します。
アプリケーションは、角度の新しい開始値を返すか、DCMに現在の計算値または測定値を保持して使用するように通知することができます。

可能な戻り値は次のとおりです：

- DCM\_VARIABLE\_ANGLE\_KEEP - DCMは現在の値を保持する必要があります。
- DCM\_VARIABLE\_ANGLE\_VALUE - 角度の値がvalに返されます。

### 17.9.3 DCM_variable_dist_start_sign - 変数の開始符号を返す

この関数は、符号付き距離寸法に関連付けられた変数には呼び出されません。つまり、左または右の半空間が指定された寸法です。
変数寸法の開始符号を指定する代わりに、符号付き距離を使用することを推奨します。

DCM_var_dist_sign DCM_variable_dist_start_sign( void* av );

この関数は、変数距離寸法へのアプリケーションポインターで呼び出されます。
アプリケーションは、現在のキラリティが変数の正の値または負の値に対応するかどうかを返す必要があります。

可能な戻り値は次のとおりです：

- DCM_VDIST_POSITIVE - 変数が負の値を持つ場合、モデルが評価されるとDCMは寸法のキラリティを変更します。
- DCM_VDIST_NEGATIVE - 変数が正の値を持つ場合、モデルが評価されるとDCMは寸法のキラリティを変更します。
- DCM_VDIST_KEEP - DCMは、最後にフラスタムを通じて出力された値から変数の開始符号を取得します。
これにより、連続した評価でソリューションが切り替わるのを防ぎますが、最初の評価時や1つ以上の方程式が編集された後にキラリティが変化する場合があります。

この関数は、完全な評価中にのみ呼び出され、変数半径寸法には呼び出されません。

### 17.9.4 DCM\_variable\_new\_value - 出力変数の値

void DCM\_variable\_new\_value( double val, void\* av );

DCMは、add\_vに渡されたポインタと、対応する変数の新しい値をアプリケーションに出力します。
変数の値が変更されていない場合、この関数は呼び出されません。
同じ情報は、DCMのvalue関数を呼び出すことでも取得できることに注意してください。

### 17.9.5 DCM\_equation\_type - 方程式の返り値の型

void\* ae へのアプリケーションポインタを使用して呼び出される関数です。
この関数は、可能な方程式のタイプのうちの1つを返す必要があります。

- DCM\_LINEAR\_EQUATION – 線形方程式（非剛体）を作成します。
- DCM\_NON\_LINEAR\_EQUATION – 非線形方程式を作成します。
- DCM\_INEQUALITY – 線形不等式を作成します（非推奨）。

バージョン73では、DCM\_INEQUALITYタイプは非推奨とされています。
新しいインテグレータはこのタイプを使用すべきではありません。このタイプは将来のバージョンでDCM\_RIGID\_LINEAR\_INEQUALITYタイプに置き換えられます。
このタイプを使用している既存のアプリケーションは現在のように動作し続けますが、新しい不等式システムのテスト方法については、お客様はD-Cubed Componentsサポートに連絡する必要があります。
- DCM\_RIGID\_LINEAR\_EQUATION – 剛体線形方程式を作成します。
- DCM\_RIGID\_LINEAR\_INEQUALITY - 剛体線形不等式を作成します（将来の使用のため、本番用ではありません）。

バージョン73では、実験的な新しい線形不等式機能が存在しますが、デフォルトではランタイムスイッチを使用して無効になっています。
これにより、以前の（DCM\_INEQUALITY）サポートとこのタイプの新しいサポートの間で選択できます。
この機能をテストするためにこの機能を有効にするために、お客様はset\_optionで使用するスイッチキーを使用するためにD-Cubed Componentsサポートに連絡する必要があります。

DCM\_LINEAR\_EQUATIONとDCM\_RIGID\_LINEAR\_EQUATIONの選択は、線形方程式が剛体方程式として作成されるかどうかを決定します。
この選択は、後続のFrustum関数呼び出しに以下のように影響します。

- DCM\_LINEAR\_EQUATION – このタイプの方程式をモデルに追加する際、DCMは定数項と係数項が固定されておらず、後続のre\_evaluate呼び出し中に変更される可能性があると仮定します。
定数項の値がadd\_eで指定されていない場合、その値はDCM\_equation\_constant\_value Frustum関数を通じて問い合わせられます。
係数項の値がadd\_v\_to\_eで指定されていない場合、その値はDCM\_equation\_coefficient\_value Frustum関数を通じて問い合わせられます。
- DCM\_RIGID\_LINEAR\_EQUATION – このタイプの方程式をモデルに追加する際、DCMは定数項と係数項が固定されていると仮定します。
定数項の値はDCM\_equation\_constant\_value Frustum関数を通じて問い合わせられますが、その値はadd\_eで直接指定されていないためです。
係数項の値がadd\_v\_to\_eで指定されていない場合、その値はDCM\_equation\_coefficient\_value Frustum関数を通じて問い合わせられます。
定数項と係数項は評価中に複数回問い合わせられる可能性があることに注意してください。
DCMは過拘束だが整合性のあるモデル（冗長な方程式による）を解決し、モデルを過定義としてマークしません。

### 17.9.6 DCM\_equation\_constant\_value - 定数値を返す

double DCM\_equation\_constant\_value( void\* ae );

DCMは、add\_eの呼び出しによってDCMに渡されたポインタをアプリケーションに渡します。
アプリケーションは、線形方程式の定数項の値を返します。

もしadd\_eに定数が渡された場合、それは変更されないと仮定され、この関数は呼び出されません。
DCM\_equation\_typeを介して指定された剛体線形方程式の場合、定数項の値はadd\_eで直接指定されなかったため、この関数を通じて完全評価中に問い合わせられます。
したがって、剛体線形方程式では、定数は増分評価中に変更することはできません。
非剛体線形方程式では、定数の値は増分評価中に問い合わせられ、変更することができます。

将来的には、この関数はDCM\_RIGID\_LINEAR\_INEQUALITYタイプのe\_nodeにも呼び出される予定です。

### 17.9.7 DCM\_equation\_coefficient\_value - 係数の値を返す

double DCM\_equation\_coefficient\_value( void\* ae, void\* av, void\* ac );

DCMは、add\_v\_to\_eの呼び出しでDCMに渡されたポインタをアプリケーションに渡します。
アプリケーションは、線形方程式の対応する係数の値を返す必要があります。

add\_v\_to\_eに数値係数値が渡された場合、それは変更されないと仮定され、この関数は対応する変数に対して呼び出されません。
剛体線形方程式の場合、この関数は完全評価中に呼び出されますが、増分評価中には呼び出されませんので、係数の値は増分評価中に変更されてはいけません。
非剛体線形方程式の場合、この関数は増分評価中にも呼び出されます。

アプリケーションに渡される情報には冗長性が含まれていることに注意してください。
これは、アプリケーションが独自のデータ構造を代替の方法で実装できるようにするためです。

将来的には、この関数はDCM\_RIGID\_LINEAR\_INEQUALITYタイプのe\_nodeに対しても呼び出される予定です。

### 17.9.8 DCM\_equation\_residual - 残差を返す

非線形方程式へのアプリケーションポインタを使用して呼び出されます。
この関数は、変数の現在の値を使用して方程式の残差値をresidualに返す必要があります。
各変数の現在の値は、DCM値関数を使用して見つける必要があります。

この関数が図形を含む方程式に対して呼び出される場合、アプリケーションはDCMインターフェース関数transformを呼び出し、図形の元の位置に対して任意の変換や半径の変更を適用して図形の現在の位置を見つける必要があります。
これは、依存するパラメトリック曲線の再生成に使用される技術とまったく同じです。

変数の現在の値で残差を計算できない場合は、DCM\_EQUATION\_FAILを返す必要があります。それ以外の場合は、DCM\_EQUATION\_OKを返す必要があります。

### 17.9.9 DCM\_equation\_derivative\_value - 導関数を返す

DCM\_equation\_status DCM\_equation\_derivative\_value( void\* ae, void\* av,

        void\* ac, double \*df );

この関数は、指定された変数(av)に関する非線形方程式(ae)の導関数(df)を返すべきです。変数の現在の値は、値関数を使用して見つける必要があります。

この関数が図形を含む方程式に対して呼び出される場合、アプリケーションはDCMインターフェース関数transformを呼び出し、図形の元の位置に対して変換や半径の変更を適用して、図形の現在の位置を見つける必要があります。
これは、依存するパラメトリック曲線の再生成に使用される技術とまったく同じです。
なお、DCMは方程式内の図形に関する導関数を問い合わせるためにこの関数を呼び出しません。

もし導関数の情報が利用できないか、変数の現在の値で計算できない場合、関数はDCM\_EQUATION\_FAILを返すべきです。それ以外の場合は、DCM\_EQUATION\_OKを返すべきです。
導関数を返すことで、DCMは方程式をより効率的に解くことができます。

### 17.9.10 DCM\_equation\_p\_node\_derivative\_value – 導関数の値を返す

DCM\_equation\_status DCM\_equation\_p\_node\_derivative\_value( void\* ae,

      void\* av, void\* ac, double \*df );

アプリケーションは、指定されたp\_node (ap) に関する非線形方程式 (ae) の導関数 (df) を返す必要があります。p\_nodeの現在の値は、help\_parameter関数を使用して見つける必要があります。
詳細は、上記のDCM\_equation\_derivative\_valueを参照してください。

### 17.9.11 DCM\_inequality\_minimum - 最小値を返す

DCM\_logical DCM\_inequality\_minimum( double\* min, void\* ae );

DCMは、DCM\_INEQUALITY型の方程式へのポインタであるaeを渡します。
もし不等式に最小値がある場合、アプリケーションはDCM\_TRUEを返し、引数minに制限値の値を設定する必要があります。
この値は、完全な評価の間に変更することができます。
もし最小制限値がない場合、アプリケーションはDCM\_FALSEを返す必要があります。

将来的には、この関数はDCM\_RIGID\_LINEAR\_INEQUALITY型のe\_nodeには必要ありません。

### 17.9.12 DCM\_inequality\_maximum - 最大値を返す

DCM\_logical DCM\_inequality\_maximum( double\* max, void\* ae );

DCMは、DCM\_INEQUALITY型の方程式へのポインタであるaeを渡します。
もし不等式に最大値がある場合、アプリケーションはDCM\_TRUEを返し、引数maxに制限値を設定する必要があります。
この値は、完全な評価の間に変更することができます。
もし最大制限がない場合、アプリケーションはDCM\_FALSEを返す必要があります。

将来的には、この関数はDCM\_RIGID\_LINEAR\_INEQUALITY型のe\_nodeには必要ありません。

### 17.9.13 DCM_v_status - 変更された変数のステータスを出力する

void DCM_v_status(DCM_g_status os, DCM_g_status ns, void* av);

変数ノードのステータスが変更された場合に呼び出されます（詳細は[14. ステータスコード](14._Status_Codes.md)を参照）。
アプリケーションには、古いステータスと新しいステータス、および変数へのアプリケーションポインタが渡されます。
これは、増分グラフィックなどの増分機能を実装するために使用することができます。

アプリケーションは、この情報を使用しない場合はダミー関数を定義することができます。

### 17.9.14 DCM\_e\_status - 出力変更された方程式の状態

void DCM\_e\_status( DCM\_d\_status os, DCM\_d\_status ns, void\* ad );

方程式ノードの状態が変更された場合に呼び出されます（詳細は[14. ステータスコード](14._Status_Codes.md)を参照）。
アプリケーションには、古い状態と新しい状態、および方程式へのアプリケーションポインタが渡されます。
これは、増分グラフィックなどの増分機能を実装するために使用することができます。

アプリケーションは、この情報を使用しない場合はダミー関数を定義することができます。

### 17.9.15 DCM\_e\_satisfied\_status – 満足情報の出力

void DCM\_e\_satisfied\_status(DCM\_satisfied\_status status, void\* ae);

モデルが満足していない方程式の場合に呼び出されます。
方程式の満足状態に関するアプリケーション情報を渡します。
