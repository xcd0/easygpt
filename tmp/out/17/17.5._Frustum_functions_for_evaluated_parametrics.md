17.5 評価済みパラメトリックのための円錐曲線関数

これらの関数は、評価済みのパラメトリック曲線がDCMに追加されている場合にのみ呼び出されます。つまり、アプリケーションがDCM_g_identifyの呼び出しでタイプDCM_PARAMETRICを返した場合です。

### 17.5.1 DCM\_parametric\_limits - パラメータ値の制限を返す

パラメータへのアプリケーションポインタを使用して呼び出され、上限（t\_up）と下限（t\_low）のパラメータ制限を返す。返り値がDCM\_TRUEの場合、周期的なパラメトリック曲線であることを示し、上限と下限のパラメータ制限を返します。DCM\_FALSEの場合、パラメトリック曲線が周期的であることを示します。
なお、t\_upはt\_lowよりも大きくなければなりません。

2D DCM with PGMを使用している顧客は、返り値がDCM\_FALSEの場合でも、t\_upとt\_lowの値を設定する必要があります（曲線が周期的な場合）。具体的には、t\_up-t\_low = 周期（DCM\_parametric\_periodの問い合わせで返されます）となるように設定してください。

増分評価中に曲線の周期性を変更することはできませんが、DCM\_TRUEが返される場合は、増分評価中にパラメータ制限を変更することができます。

### 17.5.2 DCM_parametric_period - 周期的なパラメトリックの周期を返す

void* agを引数に持つdouble DCM_parametric_period( void* ag );関数です。

この関数は、アプリケーションが以前にFrustum関数DCM_parametric_limitsを使用して周期的なパラメトリック曲線の制限をDCMに通知していない場合に呼び出されます。
アプリケーションによって返される周期は、ゼロより大きく、増分評価中に変更することはできません。

### 17.5.3 DCM_parametric_direction - パラメトリック方向を返す

void DCM_parametric_direction( double dir[2], void* ag );

アプリケーションポインタを使用して呼び出され、パラメトリック曲線の方向をアプリケーションによって定義された方向として返します。

### 17.5.4 DCM_parametric_evaluator - パラメトリックデータを返す

void DCM_parametric_evaluator( double pt[2], double p1[2], double p2[2], void* ag, double t );

パラメータtを持つパラメトリックデータとアプリケーションポインタが与えられた場合に呼び出されます。
パラメータに関連する点(pt)と一次導関数(p1)、二次導関数(p2)の座標を返します。
DCMは、pt、p1、p2のいずれかをDCM_NULLポインタとして渡すことがあります。その場合、特定の値は必要ありません。
したがって、アプリケーションは、要求された情報を埋める前にこれらのポインタの値がDCM_NULLでないことをテストする必要があります。

関数DCM_parametric_limitsが呼び出されたときにパラメータの制限が指定されている場合、tの値はこれらの制限の範囲外になることはありません。
制限が指定されていない場合、tは任意の値を取る可能性があり、アプリケーションは周期的な曲線のパラメータ範囲に持ち込む準備をする必要があります。

アプリケーションは、点(pt)と一次導関数(p1)の正確な値を返さなければなりません。二次導関数(p2)は有限差分によって推定することができます:

p2 ≈ (p1(t+q) - p1(t)) / q

### 17.5.5 DCM\_parametric\_n\_discons - 不連続点の数を返す

void* ag 内のアプリケーションパラメトリックの内部不連続点の数を要求するために、この関数が呼び出されます。
ゼロを返すと、DCMは不連続点の知識なしで解決されます。

### 17.5.6 DCM\_parametric\_discon\_data - 不連続データを返す

void DCM\_parametric\_discon\_data( double\* t, double pt\[2\], double p1\[2\],

    double p2\[2\], void\* ag,

     int dcon\_indx, DCM\_discontinuity\_side side);

DCM\_parametric\_n\_disconsが非ゼロの値（N）を返す場合、DCMはこの関数を介して不連続性の情報を要求します。
不連続性は、パラメトリックagへのアプリケーションポインタと、昇順のパラメータ値の順に番号付けされたインデックス（dcon\_indx）によって一意に識別されます（1からNまで）。
DCMはまた、不連続性の上側または下側のデータが必要かどうかを指定します。

- DCM\_DS\_LOWER \- 不連続性の下側のデータが必要です。
- DCM\_DS\_UPPER \- 不連続性の上側のデータが必要です。

アプリケーションは、指定された不連続性の指定された側（t）のパラメータ値と、そのパラメータ値での任意のヌルでないポインタのデータを返す必要があります：曲線上の点（pt）、一次導関数（p1）、および二次導関数（p2）。

DCMは、t、pt、p1、またはp2のいずれかをDCM\_NULLポインタとして渡すことがあります。その場合、これらの特定の値は必要ありません。
したがって、アプリケーションは、要求された情報を入力する前に、これらのポインタの値がDCM\_NULLでないことをテストする必要があります。

DCM\_parametric\_evaluatorと同様に、二次導関数の推定値を与えることができます。
これを行う場合、近似に使用される両方の導関数が不連続性の同じ側からであることに注意する必要があります。

単一の不連続性の上側と下側で異なるパラメータ値を返すことができます（tupper>tlowerである限り）、これにより曲線のパラメータ化に「ジャンプ」を定義することができます。

セクション[9.3 不連続性を持つパラメトリック曲線](9.3._Parametric_curves_with_discontinuities.md)を参照してください。

DCM\_parametric\_n\_disconsがゼロを返す場合、この関数は呼び出されません。

### 17.5.7 DCM_parametric_regenerate - パラメトリック曲線の更新

void DCM_parametric_regenerate( void* ag );

この関数は2つの場合に呼び出されます。

まず、DCM関数move_and_evaluateの呼び出し中に、アプリケーションがパラメトリック曲線のためにDCM_NULL変換を渡した場合に呼び出されます。
これにより、アプリケーションはパラメトリック曲線の形状を変更したいことをDCMに伝えます。
パラメトリック曲線のアプリケーションポインタが与えられ、アプリケーションは曲線の定義を更新する必要があります。

次に、DCMが1つ以上の依存制約を持つモデルを解決している場合に呼び出されます。
これは、アプリケーションに対してパラメトリック曲線を依存関係から更新するように要求するために呼び出されます。

どちらの場合でも、パラメトリックは既にDCMによって内部的に移動された他の図形に依存する場合がありますが、これらの図形の変更はまだFrustumを通じて出力されていません。
アプリケーションは、DCM関数transformを呼び出して、DCMによって図形に加えられた変更を見つける必要があります。
注意：アプリケーションは、変更が非常に小さい場合でも、これらの変換を使用して評価器を調整する必要があります。
agが他の図形にも依存するパラメトリックに依存している場合、アプリケーションはagを再生成する前にすべての依存図形を取得する必要があります。

ただし、アプリケーションはDCMがFrustum関数DCM_transformを呼び出すまで、図形を更新してはなりません。

曲線の形状と位置だけでなく、アプリケーションは曲線のパラメータの制限や、曲線の次元の任意のヘルプパラメータの値も変更することができます。

関数DCM_parametric_regenerateは、単一の評価の過程で複数回呼び出される場合があります。
各場合に、アプリケーションはパラメトリックを定義する図形の現在の変換を要求する必要があります。
これらの変換は、図形の元の位置に対して相対的です。

### 17.5.8 DCM_parametric_undo_regenerate

論理 DCM_parametric_undo_regenerate( void* ag );

この関数は、依存するパラメトリックな図形を使用するアプリケーションに必要です。

このFrustum関数を実装するために、アプリケーションはパラメトリック曲線の評価器をリセットし、初期値を返すようにする必要があります。
この関数は、移動と評価のプロセス中に呼び出されます。
複数回呼び出されることがあります。
同じ図形に対してDCM_parametric_regenerate Frustum関数の呼び出しの前に呼び出されることがあります。

アプリケーションは、次のいずれかを行う必要があります。

- 指定された図形を評価の開始時の位置に復元し、DCM_TRUEを返す。
- 指定された図形を変更せずにそのままにし、DCM_FALSEを返す。

各図形に対して、アプリケーションは常にリセットするか、決してリセットしなければなりません。
ただし、一部の図形をリセットし、他の図形をリセットしないことも許可されています。

アプリケーションがDCM_FALSEを返すか、関数が登録されていない場合、DCMはモデルを解決しようとしますが、モデルが解決できない場合、NOT_CONSISTENTのステータスが発生する可能性があります。
これは、以前のバージョンのDCMで発生していた動作です。
この関数を実装することの結果として、DCM_parametric_regenerateは以前よりも頻繁に呼び出されることになります。
