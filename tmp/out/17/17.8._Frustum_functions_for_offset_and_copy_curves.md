## 17.8 円錐曲線のオフセットとコピーのための関数

以下の関数は、楕円やパラメトリック曲線のオフセットにのみ呼び出されます。

### 17.8.1 DCM\_offset\_orientation - オフセット曲線の向きを返す

DCM\_offset\_side DCM\_offset\_orientation( void\* off\_g, void\* parent\_g );

オフセット曲線（off\_g）と生成曲線（parent\_g）のアプリケーションポインタを使用して呼び出され、定義曲線（パラメトリック曲線または楕円）に対するオフセット曲線の向き（または側面）を返します。

以下の図は、オフセットパラメトリックの概念を示しています：

![](../Resources/Images/2ddcm_manual/Frustum functions for offset.png)

図82：オフセットパラメトリック曲線の向き

オフセットパラメトリックの場合、オフセットの向きはDCM\_OFFSET\_LEFTまたはDCM\_OFFSET\_RIGHTであり、生成曲線の接線の左側または右側に曲線が存在するかを示します。パラメータ化の増加方向において、常に「左」と「右」はパラメトリック曲線を参照する際に使用されます。曲線が閉じているか周期的であるかに関係なく、「左」と「右」が使用されます。

オフセット楕円の場合、側面はDCM\_OFFSET\_INSIDEまたはDCM\_OFFSET\_OUTSIDEになります。

### 17.8.2 DCM\_offset\_distance - オフセット距離を返す

double DCM\_offset\_distance( void\* off\_g, void\* parent\_g );

アプリケーションポインタoff\_gと親曲線のアプリケーションポインタparent\_gを使用して呼び出され、オフセット距離を返します。
この距離は常に正の値で与えられるべきです。

この関数と前の関数は、評価の開始時にオフセット曲線の初期位置を見つけるために呼び出されます。
この情報は解のキラリティを定義するために使用され、曲線間の距離の結果の値には制約がありません。

### 17.8.3 DCM\_update\_offset\_data - オフセット曲線の更新

void DCM\_update\_offset\_data( void\* off\_g, void\* parent\_g,

     DCM\_offset\_side o\_side, double offset, int mask );

この関数は、オフセット曲線が変更された場合に呼び出されます。
オフセット曲線はoff\_gであり、その生成曲線はparent\_gです。
オフセット曲線はいくつかの方法で変更される可能性があり、引数maskは変更された内容を示すビットマスクです。
以下の値の合計です：

- DCM\_OFFSET\_SIDE\_CHANGED = 1 - オフセット側が変更されました。
- DCM\_OFFSET\_DIST\_CHANGED = 2 - オフセット距離が変更されました。
- DCM\_OFFSET\_PARENT\_CHANGED = 4 - オフセット親が形状が変更されました。

いずれの場合も、オフセット側と距離の現在の値が出力されます。
距離は常に正の値であり、したがって、新しい側と正の距離が返されます。負の距離と元の側を返すのではありません。

これは、DCM変換関数を介したオフセット距離の変更の出力とは異なります。
その関数では、最後の解決/元に戻すからのオフセット距離の変更が符号付き距離として出力され、オープンループの右側が正（左側が負）であるという規則に従います。閉ループの場合、正は外側です。

### 17.8.4 DCM\_copy\_transform – コピー曲線の変換行列を返す

void DCM\_copy\_transform(void\* copy\_g, void\* parent\_g, double mat\[3\]\[3\]);

アプリケーションポインタを使用して、コピー曲線（copy\_g）とその親（parent\_g）を指定し、コピー曲線の現在の変換行列を返します。

### 17.8.5 DCM\_update\_copy\_transform - コピー曲線の変換を更新する

void DCM\_update\_copy\_transform (void\* copy\_g, void\* parent\_g, double mat\[3\]\[3\]);

変換行列matは、元の曲線parent\_gの現在の（解かれた）位置を、コピー曲線copy\_gの現在の（解かれた）位置と同じにするために必要な変換です。

DCMはコピーの変換に対して増分変更を出力することはありません。常に完全な変換を出力します。
元の曲線とコピー曲線の間の変換が解かれる間に変更されない場合、この関数は呼び出されません。
これは、元の曲線とコピー曲線がまったく同じ量だけ移動される場合に起こります。

この関数に加えて、DCMはコピー曲線が解かれる間に移動する場合、DCM\_transform Frustum関数も呼び出します。
その関数から返される変換は、解かれる間に移動した量です（例：評価）。
これはコピーの変換とは関係ありません。
したがって、元の曲線とコピー曲線が同じ量だけ移動する場合、DCM\_transform関数はコピー曲線に対して呼び出されますが、DCM\_update\_copy\_transform関数は呼び出されません。

元の曲線の形状が変わると、コピーの形状も同じように変わります。
これにより、コピーの変換に変化がない場合でも、単純な剛体変換を持たないコピーに変化が生じることがあります。
その場合、通常はDCM\_transform関数は呼び出されません。

アプリケーションは、次のいずれかの方法でジオメトリ定義を更新できます：

- 元の曲線の位置を最初に更新し、その後、コピーの位置をコピーの変換を使用して計算することによって、コピーの新しい位置を求めること。
- コピーに対して標準のDCM変換出力を適用することによって、曲線に変更を適用すること。

アプリケーションは、両方の変更を適用することによってコピー曲線を必要な量だけ2倍に移動させないように注意する必要があります。
曲線を更新するための推奨される方法は、コピーの変換を使用することです。
