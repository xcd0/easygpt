## 14.6 一貫性のないステータス

DCMがこの図形を解決するために使用できると信じている解決手順を見つけた場合、NOT\_CONSISTENT\_\*ステータスコードの1つが返されます。
しかし、この手順を実装しようとすると、解決策が見つかりません。
数学的な用語で言えば、DCMは図形の「架空の」解を見つけました。
このセクションでは、一貫性のないステータスコードが発生する条件と、アプリケーションがモデルを修正してこれらを回避する方法について説明します。

### 14.6.1 一貫性のない状態の原因

モデルの一部は、さまざまな操作の結果として一貫性を欠いた状態になることがあります。
最も一般的な原因は次のとおりです。

- アプリケーションが寸法の値を変更し、evaluateまたはre_evaluateを呼び出してモデルを評価します。
これは通常、1つ以上の図形に大きな変更がある場合に発生します。
- アプリケーションがモデルに寸法または拘束を追加して、ジオメトリを移動し、その後モデルを評価します。
- アプリケーションが1つ以上の寸法のキラリティを変更し、その後モデルを評価します。
- dynamic_evaluateを使用してジオメトリをドラッグする場合、アプリケーションは大きな変換を入力しようとします。
- move_and_evaluateを使用してジオメトリを移動する場合、アプリケーションは大きな変換でジオメトリを移動しようとします。

一般的に、一貫性のない状態は、アプリケーションがモデルに対して行おうとしている変更が大きすぎることを示しています。
この文脈では、「大きい」とは、モデルのサイズに対して相対的であり、またモデルが特異解に近いかどうかにも関係します。
通常、同様のがらくたが小さな変更が行われた場合、この状態は発生しません。
ドラッグおよび増分評価の場合、変更の大きさはジオメトリの初期位置に対して相対的です。
これは、dynamic_evaluateへの最初の呼び出しまたはevaluateへの最新の呼び出し時のジオメトリの位置です。

DCMがモデルを解決するとき、ジオメトリのいずれかの変換を計算し始める前に、どの解決手順を使用するかを決定します。
過拘束の場合は、この段階で検出されます。
DCMが各ジオメトリに適用する変換を計算する際、1つ以上のジオメトリの解決策を見つけることができないと判断し、それらを一貫性のない状態としてマークします。
ジオメトリの位置を決定するためにDCMが使用している寸法も同じステータスコードが与えられます。

ジオメトリが一貫性を欠いた状態になると、DCMはそれに依存する他のジオメトリを配置することができません。
これらのジオメトリとそれに関連する寸法（およびそれに依存する他の寸法）は、G_NOT_CHANGEDまたはD_NOT_SOLVEDとしてマークされます。
詳細は、[14.7 解決できないノード](14.7._Nodes_which_cannot_be_solved.md)を参照してください。

### 14.6.2 不整合な問題の解決

アプリケーションは、問題が発生した場合にユーザーにすぐにわかるように、モデルを頻繁に評価することが推奨されます。
多くの操作（寸法値の変更やキラリティの変更など）では、re_evaluate関数を使用してモデルを評価することが可能です。

すべての場合において、アプリケーションは問題を解決するために、それを引き起こした操作を元に戻すことができます。
例えば、不整合なステータスコードが寸法値の変更によって引き起こされた場合、寸法を元の値に戻し、re_evaluateを呼び出すことで問題は解決されます。
ただし、場合によっては、アプリケーションは変更を可能にするためにモデルの他の部分を変更したい場合もあります。
以下のセクションでは、試行できる異なる方法について説明します。

問題の解決を試みる際には、アプリケーションは不整合なステータスコードを持つモデルの図形と寸法に焦点を当てるべきです。

このステータスを回避する方法を決定するために、不整合な構成の異なるタイプを考慮することが役立ちます。
以下にそれらを説明します。

#### 14.6.2.1 NOT\_CONSISTENT\_DIMENSIONS

この場合、ローカルの設定は完全に寸法が決まっています。
例えば、辺の長さが50、50、120の三角形です。しかし、DCMは辺の長さが50、50、100のような境界ケースも評価します。

![fig59_incon_can.bmp](../Resources/Images/2ddcm_manual/Not consistent status.png)

図69: (a) 不整合、変更されません (b) 評価可能、変更されます

このステータスコードが返された場合、以下のテクニックが問題を解決するかもしれません：

- 寸法値の変更
- 異なるキラリティへの変更

それぞれの詳細については以下で説明します。

#### 14.6.2.2 NOT\_CONSISTENT\_OTHER

この場合、ローカルな設定は完全に寸法が決まっていません。
これは、部分的に寸法が決まっているモデルで図形をドラッグする場合などに起こります。

![fig60_dragging_under.bmp](../Resources/Images/2ddcm_manual/Not consistent status_1.png)

図70: 寸法が不足しているモデルのドラッグ

寸法が完全に決まっていないモデルでは、以下のテクニックを使用して問題を解決することができます：

- 寸法の値を変更する。
- 追加の拘束条件を追加する。
- 図形を移動する。
- 異なるキラリティに変更する。
- 異なる解決モードを使用する。

これらの詳細な説明は以下に示されています。

なお、[図70: 寸法が不足しているモデルのドラッグ](#_Ref475516914)のような、複数の寸法が不足している点が距離寸法のみで接続されているモデルを解決する場合、チェインソルバを使用してパフォーマンスを向上させることができます。
詳細は、セクション[16.2.4.10 寸法が不足している点の距離寸法による解決動作の改善](16.2._Configure_global_DCM_behaviour.md)を参照してください。

#### 14.6.2.3 NOT\_CONSISTENT\_UNKNOWN

この場合、DCMは非一貫な状態の原因を特定できませんでした。
[14.6.2.2 NOT\_CONSISTENT\_OTHER](#_Ref514731905)のセクションで言及された解決策を使用することができます。

#### 14.6.2.4 NOT\_CONSISTENT

このステータスコードは、アプリケーションがset\_option関数を呼び出して、DCM\_OPKEY\_STATUS\_VERSIONオプションをDCM\_OPVAL\_STATUS\_400の値に設定した場合にのみ返されます。この場合、これは他のすべてのNOT\_CONSISTENT\_\*コードを置き換えます。

### 14.6.3 寸法値の変更

DCMは、解決策を見つけるために変更できるすべての寸法を特定します。
例えば、[図69: (a) 矛盾しているため変更されない (b) 評価可能なため変更される](#_Ref474822240)のaでは、3つの寸法がすべて非一貫とマークされ、アプリケーションはこれらのいずれかの値を変更して有効なモデルを生成することができます。
ただし、一部の場合には論理的な制約が非一貫とマークされますが、明らかに変更できる値はありません。

寸法値の変更は、明確に定義された構成と未定義の構成の両方の問題の解決に役立ちます。
これは、明確に定義された構成で非一貫な図形の問題を回避するための推奨される方法です。

### 14.6.4 追加の拘束条件や寸法の追加

未定義のモデルに対して、さらなる寸法や拘束条件を追加すると、DCMは異なる解決手順を選択します。
多くの場合、これはDCMが望ましい解を見つけるのを助けるために使用できます。
一部のモデルでは、図形が拘束されているように見えるかもしれませんが、モデルが変更されると、拘束条件が存在しないことが明らかになる場合があります。
これらの拘束条件を追加することで、一貫性のないケースを回避するのに役立ちます。

追加の拘束条件や寸法の追加は、未定義の構成で一貫性のない図形の問題を回避するための推奨される方法です。

### 14.6.5 図形の移動

拘束不足モデルでは、図形を移動させることで、DCMが解を見つけるのを助けることができるかもしれません。
同様に、単純な変数の初期値を変更することも助けになるかもしれません。
これは、完全に定義された図形には影響を与えません。

ただし、ヘルプポイントの位置を変更したり、ヘルプパラメータの値を変更したりしても、キラリティに変化がない限り、解に影響を与えません。
これについては、次のセクションで説明します。

### 14.6.6 異なる手性への変更

通常、モデルには異なる手性が多く存在し、それぞれが図形の異なる解に対応しています。
これらの解の多くは、一貫性のない図形をもたらす可能性があります。
逆に、異なる手性に変更することで、DCMが解を見つけるのを助けることができるかもしれません。

手性を変更する方法はいくつかあります:

- change\_chirality関数を使用して明示的に変更する方法。
- モデルを評価する前に図形を移動する方法。
- ヘルプポイントの位置を移動したり、ヘルプパラメータの値を変更する方法。

手性の変更は、明確に定義されたモデルや未定義のモデルに影響を与える可能性があります。
手性の変更の詳細については、[5. 手性](5._Chirality.md)の章を参照してください。

14.6.7 異なる解決モードの使用

解決モードは、evaluate、re_evaluate、move_and_evaluate、dynamic_evaluate関数に指定することができます。
使用される解決モードは、定義済みの図形には影響を与えません。未定義の図形のみに影響を与えます。
これらの関数では、デフォルトの解決モードを使用することが推奨されますが、解決モードを変更することで、図形が一貫性を持たなくなることを回避することができるかもしれません。
一般的に、異なる解決モードの影響は以下の通りです。

- 最小移動解決は変更を局所化し、したがって最小限の数の図形を移動します。望ましい解決策に追加の図形の移動が必要な場合、モデルの一部が一貫性を持たなくなる可能性があります。他の解決モードに変更することで、これを回避することができます。
- 標準解決は、特異点付近の図形を変更せず、隣接する図形に変換を伝播させます。これにより、最小移動解決よりも広範囲の移動に対して図形が一貫性を持たなくなることを回避します。
- 緩和解決は、数値的な緩和法を使用して未定義の図形を解決します。この解決モードでは、多くの図形が移動することがよくあり、これにより他の解決モードよりも広範囲の移動に対して図形が一貫性を持たなくなることを回避することができます。ただし、この解決モードでは、図形が望ましくない方法で移動する可能性があります。

アプリケーションは、一貫性のない図形を回避する手段として、ユーザーに緩和解決の使用の機会を提供することができます。ただし、変更内容が常にユーザーの期待通りであるとは限りませんので、注意が必要です。
- 重み付き標準解決は、evaluate関数に渡されたリストで指定された図形を変更しません。それ以外の場合は、標準解決と同様の方法で解決します。move_and_evaluateと一緒に使用する場合、そのコマンドで配置された図形を移動しないようにします。この解決モードは、DCMの利用可能なオプションを制限するため、標準解決よりも一貫性のない図形が生じる可能性が高くなります。
- 局所解決は、最小移動解決と標準解決のいくつかの特性を組み合わせたものです。図形の移動数を最小化することではなく、局所的な図形の移動を試みる戦略によって、図形の移動数を減らすはずです。したがって、最小移動モードよりも広範囲に対して解決しますが、標準解決モードほど広範囲には解決しません。
