## 16.3 モデルデータの定義

このセクションでは、モデルデータを追加または削除するために使用される関数について説明します。

### 16.3.1 add\_g - DCM内に図形ノードを作成します

g\_node\* add\_g( void\* ag );

アプリケーションの図形ノードへのポインタを受け取り、新しいDCM図形ノードへのポインタを返します。
add\_gは、DCMに剛体セットを追加するためにも使用されます。

DCMは、add\_gの呼び出し中に図形に関する情報を問い合わせるためにFrustum関数を呼び出す場合があることに注意してください。
したがって、アプリケーションはこの関数を呼び出す前にデータを初期化する必要があります。

### 16.3.2 add\_offset\_g - パラメトリックまたは楕円にオフセットを作成します

g\_node\* add\_offset\_g( void\* off\_g, g\_node parent\_gn );

アプリケーションのジオメトリノードへのポインタと、パラメトリック曲線（DCM\_PARAMETRIC、DCM\_CONIC、DCM\_SPLINE）、楕円、または他のオフセット曲線である必要があるg\_nodeを取ります。
DCMは、オフセットジオメトリを表す新しいジオメトリノードへのポインタを返します。

### 16.3.3 add\_copy\_g - パラメトリックまたはオフセットのコピーを作成します

g\_node\* add\_copy\_g( void\* copy\_g, g\_node parent\_gn );

アプリケーションのジオメトリノードへのポインタと、パラメトリック曲線（DCM\_PARAMETRIC、DCM\_SPLINE、DCM\_CONIC、またはオフセット曲線である必要がある）であるg\_nodeを取ります。
DCMは、コピーされたジオメトリを表す新しいジオメトリノードへのポインタを返します。

ポイント、ライン、サークル、楕円、セット、パターン、相対変換ノード、またはPGM g\_nodeを含むサポートされていないジオメトリタイプからのコピーg\_nodeの作成の試みは無視され、関数はDCM\_NULLを返します。

### 16.3.4 add\_r と add\_d - 寸法ノードを作成する

r\_node\* add\_r( void\* ad, g\_node\* gn );

d\_node\* add\_d( void\* ad, g\_node\* gn1, g\_node\* gn2 );

d\_node\* add\_d( void\* ad, g\_node\* gn1, g\_node\* gn2, g\_node\* gmid );

d\_node\* add\_d( void\* ad, g\_node\* gn1, g\_node\* gn2, g\_node\* gn3, g\_node\* gn4);

d\_node\* add\_d( void\* ad, p\_node\* pn1, p\_node\* pn2 );

d\_node\* add\_d( void\* ad, g\_node\* gn, v\_node\* vn );

[2\. Fundamental DCM Concepts](2._Fundamental_DCM_Concepts.md)の章を参照してください。
add\_dはほとんどの寸法に使用され、add\_rはロック、半径、パターン値の寸法など、1つの図形ノードに適用される寸法に使用されます。

add\_dの最初の形式は、アプリケーションの寸法ノードへのポインタと、2つの関連するDCM図形ノードを受け取り、新しいDCM寸法ノード（d\_node）を返します。ほとんどの場合、2つの図形ノードは異なる必要があります。
ただし、曲線の長さと等しい曲線の特性の制約は、同じg\_nodeを使用して定義することができます。これにより、同じパラメトリック曲線の2つの位置が同じ特性を共有することを示します。

2つの図形ノードの順序は、角度寸法、符号付きの方向距離、パターン制約、依存制約を除いて重要ではありません。
依存制約の場合、最初の図形は、2番目の図形に依存するパラメトリックでなければなりません。

add\_dの2番目の形式は、3つのDCM図形ノードを受け取り、円弧の長さの寸法または対称、中点、パターン、等しい相対変換制約を作成するために使用されます。

- 対称制約の場合、3番目のノードは直線でなければならず（これが対称軸になります）、他の2つのノードは同じタイプでなければなりません。
[7.2.3 Symmetric, coincident, patterned and equal relative transform](7.2._Dimensions_and_constraints_to_parametric_curves.md)を参照してください。
- 中点制約の場合、3番目のノードは点でなければならず、他の2つのノードはどちらも点または直線でなければなりません。
- 円弧の長さの制約の場合、最初の2つのノードは点でなければならず、3番目のノードは円でなければなりません。
有効な円弧の長さの寸法を構築するには、DCMは点が円に一致している必要があります。そうでない場合、DCMは制約を過剰定義としてマークします。
各点には、次のいずれかの条件が必要です。

- 点は円にDCM\_COINCIDENT制約で制約されています。
- 点と円が両方とも固定されており、点が幾何学的に円に一致しています。
- 点と円が同じDCM剛体セット内にあり、点が幾何学的に円に一致しています。

- 1Dまたは2Dのパターン制約、または等しい相対変換制約の場合、3番目のノードは対応する作成関数（add\_patternまたはadd\_pattern\_2dまたはadd\_relative\_transform）によって作成される参照ノードであり、他の2つのノードは同じタイプまたはコピーg\_nodeとその親または別のコピーg\_nodeでなければなりません。
これらの制約タイプでは、ノードの順序が重要です。
- 2Dパターン制約の場合、パターン制約が既存の制約と組み合わさって同じパターン参照ノードへのチェーンを作成する場合、DCMはNULLポインタを返します。これは、g\_nodeがgn1としてadd\_dの1つの呼び出しで使用され、同じパターン（gmid）の別のadd\_d呼び出しでgn2として使用される場合にのみ発生します。

add\_dの3番目の形式は、等しい距離制約を追加するために使用されます。
gn1とgn2の間の距離は、gn3とgn4の間の距離と同じになります。4つの図形はすべて点、直線、または円でなければなりません。
[2\. Fundamental DCM Concepts](2._Fundamental_DCM_Concepts.md)を参照してください。

add\_dの4番目の形式は、2つのp\_node間の等しいパラメータ制約を追加するために使用されます。
p\_nodeは、関数parameter\_nodeを使用して作成する必要があり、両方のp\_nodeは同じジオメトリに関連付けられている必要があります。

add\_dの5番目の形式は、変数とパラメトリックの間の依存制約を追加するために使用されます。

add\_rは、アプリケーションの寸法ノードへのポインタと関連するDCM図形ノードを受け取り、r\_nodeを返します。
r\_nodeは、ジオメトリの内部自由度の値を制御する寸法（つまり、円や楕円の半径またはパターンの寸法値）または値を持たないロック制約です。
半径が等しい制約にはadd\_d関数が使用されることに注意してください。

寸法のタイプがジオメトリまたはジオメトリに適していない場合、関数はnullポインタ値を返します。
タイプDCM\_IDENTICALおよびDCM\_OFFSETは、データの出力にのみ使用され、add\_dおよびadd\_r関数と併用することはできません。

セットであるジオメトリノードは、add\_dに渡してはいけません。
セットであるジオメトリノードは、セット全体またはその方向をロックするロック制約を追加する場合にadd\_rに渡すことができます。

同じadの値をこれらの関数の複数の呼び出しに使用することができます。これは、モデル内の一致制約の各インスタンスで新しいアプリケーションデータを作成するのを避けるために使用できます。
ただし、これを行うと、Frustumが呼び出されるときに異なるノードを区別することはできません。

add\_gに関するコメントは、これらの関数にも適用されます。

### 16.3.5 fix - DCM内の図形ノードを修正する

void fix( g\_node\* gn );

DCM内の図形ノードへのポインタを受け取り、現在自由または凍結状態であれば修正し、現在固定状態であれば自由にします。
固定された図形は、dynamic\_evaluate関数またはmove\_and\_evaluate関数の呼び出しで明示的に指定された場合にのみ、DCMによって変更されます。
固定された図形は、設計の一部が絶対座標で指定されている場合に便利です。
また、剛体運動を除去する場合にも必要です（詳細は[2.3 自由度](2.3._Degrees_of_freedom.md)を参照）。

固定されたg\_nodeの状態は、モデルが評価されたかどうかに関係なく常にG\_FIXEDです。
固定されたg\_nodeが自由になった場合、その状態はモデルが評価された後までG\_UNKNOWNとなります。

セットも固定することができます。
これは、セット内のすべての図形を固定することと同等です。
パターンは固定できません。

### 16.3.6 fix - DCM内のp\_nodeを修正する

void fix( p\_node\* pn );

p\_nodeは、寸法と寸法によって制約された図形（パラメトリックまたは楕円）に関連付けられています。
parameter\_node関数を呼び出すことで返されます。

図形がパラメトリックの場合、p\_nodeを修正すると、ヘルプパラメータが「固定」されます。
DCMは、固定されたp\_nodeのヘルプパラメータを変更しません。

楕円に関連付けられたヘルプポイントが存在する場合、p\_nodeを楕円に固定することができます。
楕円に関連付けられたp\_nodeを固定すると、DCMは必要に応じてヘルプポイントの位置を楕円上に正確に更新します。
その後、モデルが評価される際に、DCMはヘルプポイントが楕円上を移動しないようにします。

パラメトリック曲線または楕円上のp\_nodeを固定すると、モデルが評価される際に解が曲線上を移動する自由度がなくなります。

固定されたp\_nodeの値が変更された場合、アプリケーションはフル評価を実行する必要があります。
新しい値をDCMで更新するために、固定されたヘルプパラメータの値を変更する場合は、resetを呼び出してフル評価を強制することをおすすめします。
再評価または動的評価が次に呼び出される場合でも、フル評価が行われます。

### 16.3.7 freeze - DCM内の図形ノードを凍結する

void freeze( g\_node\* gn );

DCM内の図形ノードへのポインタを受け取り、そのノードが現在自由または固定されている場合は凍結し、現在凍結されている場合は解凍します。
DCMは、dynamic\_evaluate関数またはmove\_and\_evaluate関数の呼び出しで明示的に指定された場合にのみ、凍結された図形を変更します。

凍結された図形は、固定された図形といくつかの類似点と違いがあります。
詳細は、[6\. 固定、凍結、自由な図形](6._Fixed,_Frozen_and_Free_Geometry.md)を参照してください。

凍結されたg\_nodeの状態は、モデルが評価されたかどうかに関係なく常にG\_FROZENです。
凍結されたg\_nodeが解凍されると、モデルが評価されるまでその状態はG\_UNKNOWNになります。

### 16.3.8 add\_pattern - 1Dパターンの参照ノードを追加する

void\* agとジオメトリ(g\_node\* gnpat)へのポインタを引数に取ります。ジオメトリは、直線（線形パターンの場合）または円または点（角度パターンの場合）になります。新しいDCM 1Dパターン参照ノード（ジオメトリとして表される）へのポインタを返します。

なお、ポインタagは、DCMがFrustum関数DCM\_g\_status、DCM\_pattern\_value\_update、DCM\_pattern\_start\_valueを呼び出すためにのみ使用されます。
パターン参照ノードに対しては、関数DCM\_g\_identifyは呼び出されません。

### 16.3.9 add\_pattern\_2d – 2Dパターンの参照ノードを追加します。

g\_node\* add\_pattern\_2d(void\* g, g\_node\* gnpat1, g\_node\* gnpat2);

パターン（ag）を参照するアプリケーションポインタと、パターンの方向を定義するジオメトリ（gnpat1とgnpat2）へのポインタを指定して呼び出します。これらのジオメトリはDCM\_LINE型である必要があります。
新しいDCM 2Dパターン参照ノード（ジオメトリとして表されます）へのポインタを返します。

なお、ポインタagは、DCMがFrustum関数DCM\_g\_status、DCM\_pattern\_2d\_value\_update、DCM\_pattern\_2d\_start\_valueを呼び出すためにのみ使用されます。
パターン参照ノードに対しては、関数DCM\_g\_identifyは呼び出されません。

### 16.3.10 add\_relative\_transform – インスタンスのための参照ノードを追加する

void\* agを引数に取り、コンテナg\_nodeを作成します。このコンテナは、2つの同一のペアの図形を等しい相対変換関係でリンクするために使用され、一方のグループを他方の「インスタンス」として考えることができます。

相対変換ノードは、対称関係における対称軸に類似しています。
add\_dへの呼び出しで、DCM\_EQUAL\_RELATIVE\_TRANSFORMの制約を追加する際に、提供されたg\_nodeは3番目のg\_nodeとして使用されます。

剛体セットと同様に、相対変換には回転角度と変換のオフセット移動の3つの自由度があります。
これらの自由度は、同一のペアの図形の2つのグループ間に制約を追加することで除去することができます。

相対変換g\_nodeには物理的な位置はありませんが、関連する変換は存在します。
この変換は、DCMによって解決の開始時に問い合わせられ（DCM\_relative\_transform\_transform Frustum関数を介して）、終了時に出力されます（DCM\_transformを介して）。また、アプリケーションは変換関数を介して問い合わせることもできます。

相対変換g\_nodeは、fix関数を使用して固定することもできます。この場合、自由度はすべて除去され、DCMはリンクされた図形間の変換がDCM\_relative\_transform\_transformで指定されたものであることを保証します。
このg\_nodeに対してFrustum関数DCM\_transform\_biasが呼び出されます（固定されていない場合）。これにより、アンダーディフィニドモデルがインスタンス間の変換を変更するか、インスタンス内の図形の位置を変更するかをより細かく制御することができます。

相対変換は常に完全な絶対変換として指定されます。
以前の値に対する増分変更を介して更新されることはありません。

### 16.3.11 move\_to\_set - 図形をセットに配置する

DCM\_logical move\_to\_set( g\_node\* gn, g\_node\* setgn );

アプリケーションは、2つの図形ノードへのポインタを渡します。
これらのうち、2番目の図形ノードはセットでなければなりません（つまり、Frustum関数DCM\_g\_identifyが返す型はDCM\_SETである必要があります）。これらのうち、最初の図形ノードはセットやオフセット曲線、またはオフセット曲線に基づくコピー曲線ではない図形でなければなりません。
DCMは、指定されたセットのメンバーに図形を追加します。

セットにセットを追加したり、図形に図形を追加するなど、無効なリクエストが行われた場合、関数はDCM\_FALSEを返します。
それ以外の場合は、DCM\_TRUEを返します。

図形がすでにセットのメンバーである場合、元のセットから削除され、指定されたセットに追加されます。
setgnがDCM\_NULLポインタの場合、図形は現在のセットから単に削除されます。

### 16.3.12 parameter\_node - p\_nodeを返す

p\_node\* parameter\_node( void\* ag, g\_node\* gn, d\_node\* dn);

この関数は、与えられた図形ノード（gn）と寸法ノード（dn）に関連付けられたp\_nodeを返します。図形は、パラメトリックまたは楕円である必要があり、寸法によって制約されている必要があります。また、ヘルプポイントまたはパラメータが提供されている必要があります。
ポインタagは、p\_nodeをアプリケーションオブジェクトに関連付けるために使用できます。
p\_nodeは、DCM関数fixを使用して値を固定するか、p\_nodeを非線形方程式に追加することによって、パラメトリックまたは楕円に制約が適用される場所を制御するために使用できます。

p\_node\* parameter\_node( void\* ag, d\_node\* dn, DCM\_constraint\_end end);

この関数は、単一の図形制約の1つの端に対してp\_nodeを返すために使用されます。この制約は、単一のパラメトリック図形の2つの位置間に適用される制約です。
endの値によって、制約の2つのヘルプパラメータのうちどちらを使用してp\_nodeを作成するかが決まります。以下のいずれかになります：

- DCM\_CONSTRAINT\_END\_ONE
- DCM\_CONSTRAINT\_END\_TWO

16.3.13 erase - DCMシステム内のノードを削除します

void erase( g\_node\* gn );

void erase( d\_node\* dn );

void erase( r\_node\* rn );

void erase( v\_node\* vn );

void erase( e\_node\* en );

void erase( p\_node\* pn );

DCM内のノードへのポインタを受け取り、そのノードを削除します。
アプリケーションはおそらく、この時点でそれに相当するデータ構造も削除したいと思うでしょう。
DCMの内部構造が破損しないようにするため、図形ノードを削除すると、関連する寸法ノードや半径ノード、および関連するp\_nodeも削除されます。
アプリケーションを支援するために、DCMは削除された各ノードに対してfrustum関数DCM\_erased\_nodeを呼び出します。
この関数の例の実装は、dimension\_system::erase()の元の呼び出しの後に削除する必要があるアプリケーションオブジェクトのリストを作成することです。

セットが削除されると、セットに追加されていたジオメトリが削除された後にセットから削除されます。

寸法ノードを削除すると、関連するp\_nodeも削除されます。
また、関連する変数ノードも削除され、この変数は追加されていた方程式からも削除されます。
アプリケーションは、これを考慮に入れるために自身のデータ構造を更新する必要があります。
DCM\_erased\_node frustum関数を使用して、これらの変更を追跡することができます。

変数が寸法に関連付けられている場合、寸法は値を持つものに戻ります。
変数は、add\_v\_to\_eを使用して追加された方程式からも削除されます。

方程式が削除されると、この方程式に含まれる変数は削除されません。

スプラインの制御点であるポイントを削除すると、スプラインも削除されます。

楕円、評価されたパラメトリック曲線、スプライン、またはオフセット曲線を削除すると、関連するオフセット曲線とコピー曲線も削除されます（[11.1.4 オフセット曲線の削除](11._Offset_and_copy_curves.md)を参照）。

### 16.3.14 erase\_all – DCMシステム内のすべてのノードを削除します

void erase\_all();

erase\_allは、DCMインスタンス内のすべてのDCMノードを一括で削除し、インスタンス自体は削除しません。

erase\_allは、DCMを空にする便利な方法ですが、DCMインスタンスを保持します。
これにより、グローバルDCMオプションに設定されたデフォルト以外の値、フラスタム関数の登録、およびジャーナリングオプションを保持することができます。

以前は、アプリケーションがインスタンス全体を削除せずにDCMを空にする唯一のオプションは、各DCMノードに対してインターフェース関数eraseを呼び出すことでした。

erase\_allは、各ノードがDCM内で削除されることをアプリケーションに通知するために、Frustum関数DCM\_erased\_nodeを呼び出します（この関数が登録されている場合）。

DCMインスタンスを削除する前に、erase\_allを使用して、デストラクタによって呼び出されるフラスタム関数を回避することができます。
DCM\_erased\_nodeから例外がスローされる可能性のあるアプリケーションは、デストラクタの呼び出しによって例外がスローされないように、この関数を使用することをお勧めします。

erase\_all内でDCMがノードを削除する順序は変更される可能性があります。

### 16.3.15 update\_extensions – 図形の拡張を追加、更新、または削除する

unsigned int update\_extensions( g\_node\* gn );

この関数は、スプライン、評価されたパラメトリック、オフセット曲線、または楕円のいずれかである g\_node のポインタを受け取ります。
この関数を呼び出すと、DCM はフラスタムを介して図形の曲線拡張に関する情報を問い合わせます。
アプリケーションは、これらの呼び出しを使用して、以前に指定されていない場合に拡張を追加したり、既存の拡張を削除したり、既存の拡張の定義を更新したりすることができます。

この関数は、拡張が正常に更新されたかどうかを判断するために使用できる整数を返します。更新に失敗した場合は、失敗の詳細情報を抽出するために使用できます。
通常、失敗はフラスタムを介して供給される非互換なデータの結果です。
更新が成功した場合、返される値はゼロです。
返される整数は、以下のエラーコードの合計です：

- DCM\_PARA\_EXT\_UPDATE\_ERROR = 1 – 更新中にエラーが発生しました。詳細な説明については、他のコードを確認してください。
- DCM\_PARA\_EXT\_UPDATE\_MIN\_END\_ERROR = 2
- DCM\_PARA\_EXT\_UPDATE\_MIN\_END\_PARAMETERS\_ERROR = 4
- DCM\_PARA\_EXT\_UPDATE\_MIN\_END\_INCOMPATIBLE\_START\_TYPE = 8
- DCM\_PARA\_EXT\_UPDATE\_MAX\_END\_ERROR = 16
- DCM\_PARA\_EXT\_UPDATE\_MAX\_END\_PARAMETERS\_ERROR = 32
- DCM\_PARA\_EXT\_UPDATE\_MAX\_END\_INCOMPATIBLE\_START\_TYPE = 64

詳細なコードは以下のようになります：

- MIN または MAX - 失敗した曲線の拡張。
- PARAMETERS - 無効なパラメータが指定されました - 例えば、開始パラメータが元のパラメータ範囲内にありません。
- START\_TYPE - スプラインまたは評価されたパラメトリックに指定された曲線の終端にない拡張。

詳細なガイダンスについては、セクション [17.6.1 DCM\_parametric\_extension\_data – 曲線への拡張の定義](17.6._Frustum_functions_for_evaluated_parametrics_and_splines.md) を参照してください。
曲線の拡張の設定に関する一般的なガイダンスについては、セクション [7.5 Curve extensions](7.5._Curve_extensions.md) を参照してください。
