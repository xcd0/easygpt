## 15.11 非線形方程式を用いた高度な拘束のモデリング

このセクションでは、アプリケーションが非線形方程式で図形を使用して、ループの面積やループの重心などの高度な拘束を実装する方法について説明します。

### 15.11.1 スカラー値の拘束

このセクションでは、ジオメトリノードを使用してスカラー値の関数（ループの長さ、ループの面積など）を非線形方程式で拘束する方法について説明します。これを行うには、アプリケーションが次の手順を実行する必要があります。

- DCMに非線形方程式を追加します。
- スカラー値が依存するすべてのジオメトリをこの方程式に追加します。

f(g1, g2, …, gn) = 0.0
- 方程式の残差を計算します。

f(g1, g2, …, gn) \- required\_value = residual

DCMがFrustum関数DCM\_equation\_residualを呼び出すとき、required\_valueは拘束されたエンティティの値です。残差は、現在のジオメトリの位置と変数の値を使用して計算されます。変数と方程式のためのFrustum関数については、セクション[17.9 変数と方程式のためのFrustum関数](17.9._Frustum_functions_for_variables_and_equations.md)を参照してください。

必要な値は変数（v1）である場合もあります。これは非線形方程式に追加することができます。

たとえば、複数の曲線で構成されるループの長さを制約する場合、アプリケーションは各曲線（直線の場合は厳密に必要ではありません）と境界点を非線形方程式に追加します。長さは境界点のみによって定義されるため、直線エッジを方程式に追加する必要はありません。

なお、PGMではループの長さを曲線の長さ寸法を使用して直接寸法付けすることも可能です。

### 15.11.2 ベクトル値の拘束

セクション[15.11.1 スカラー値の拘束](#_Ref469990341)では、非線形方程式内のジオメトリノードを使用してスカラー値（例：プロファイルの周囲長）を拘束する方法が示されています。この方法は、ベクトル値（例：プロファイルの重心）を拘束するために拡張することができます。
この場合、ベクトルの各成分ごとに別々の方程式が必要です。

例えば、アプリケーションは以下のようにして点をプロファイルの重心に拘束することができます：

- プロファイル（点と曲線）のジオメトリ（g1、g2、...、gn）をDCMに追加します。
- 重心のための点（P）を追加します。
- 2つの非線形方程式を追加し、プロファイルのジオメトリ（点と曲線）を両方の方程式に追加します。

f(g1、g2、...、gn、P) = 0.0
- DCMがFrustum関数DCM\_equation\_residualを呼び出す際に、これらの方程式の残差を計算します。2つの方程式の違いは、1つの方程式がPのx成分のみを使用し、2つ目の方程式がy成分を使用することです。



残差は、現在のジオメトリ位置と変数の値を使用して計算されます。[17.9 変数と方程式のためのフラスタム関数](17.9._Frustum_functions_for_variables_and_equations.md)のセクションを参照してください。
