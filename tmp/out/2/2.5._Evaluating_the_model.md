## 2.5 モデルの評価

このセクションでは、DCMがモデルを解決または評価する方法に関連するいくつかの重要な概念について説明します。
DCMは、特定の用途に合わせて調整された評価関数を提供していますが、すべての関数は同じ基本原則に従います。

解析および制約の自動生成のために、追加のDCM関数が提供されています。
制約を完全に解決する必要がない解析関数には、制約のバランス、モデルの満足度、特異性の程度などが含まれます。
自動関数には、自動制約と自動寸法があります。
これらは、マニュアルの別のセクションで詳しく説明されています。

### 2.5.1 一般

評価中、DCMは以下のことを試みます：

- 非剛体寸法と方程式の値を変更できる一貫性のあるモデルを確保します。
- 方程式を解き、変数の値を求めます。
- 現在定義されている寸法が満たされるように、図形に適用する変換を決定します。
- 評価の成功または失敗に応じて、各エンティティにステータスコードを設定します。

これらの手順は、モデル全体に対して同時に実行されます。

DCMによっては、単一の解が見つかります。
どの解が見つかるかは、幾何学、寸法、方程式の初期設定、キラリティの変更の保留中の要求に依存します。
また、DCMに渡されるオプションにも依存します。
多くのオプションは、未定義のジオメトリに対してどの解が見つかるかに影響を与えるため、以下で説明されています。
よく定義されたジオメトリの解決位置は、これらのオプションに影響を受けません。

アプリケーションは、評価手順の一部として、DCMに指定された変換をジオメトリに適用するように要求することもできます。
詳細については、[2.5.4 ジオメトリのドラッグ](#_Ref410529785)および[5.3 ジオメトリの移動とキラリティの保持](5.3._Moving_geometry_and_preserving_chirality.md)を参照してください。

以下のセクションでは、ジオメトリの評価の詳細について説明します。
セクション[16.8 モデルの評価](16.8._Model_evaluation.md)

### 2.5.2 解像度と精度

解像度は、DCMが比較を行う際に使用する数値のことを指します。
通常、これらの比較は、特定の方法で処理する必要がある特殊なケースを検出するために使用されます。
DCMは、DCMインスタンスを構築する際にアプリケーションによって設定される2つの解像度値を使用します。

そのうちの1つは無次元の値で、角度の比較に使用されます。
これは角度の解像度と呼ばれます。
もう1つは長さの次元を持ち、距離の比較に使用されます。
これは線形解像度と呼ばれます。
比較が必要な場合には適切な値が使用されます。

例えば、DCMは2つの固定された直線が平行かどうかをテストする必要があるかもしれません。
この場合、角度の解像度が使用されます。
同様に、ある寸法値が他の2つの寸法値の合計に等しいかどうかを調べる必要があるかもしれません。
この場合、線形解像度が使用されます。

![Fig1_resolution.bmp](../Resources/Images/2ddcm_manual/Evaluating the model.png)

図2：解像度の使用例

3つ目の値は、線形解像度と角度の解像度を関連付けることができます。
これはサイズと呼ばれ、線形解像度を角度の解像度で割ることで求められます。
幾何学的には、2つの直線が一つの端点で一致し、その間に角度の解像度がある場合、サイズの長さで分離されます。

原則として、モデルの不正確さが解像度と類似している場合、それはサイズよりも小さい場合にのみ一貫して処理できます。

精度は、DCMによって見つかった解が入力データとどれだけ近いかを示します。
代数的に解かれた解の場合、解の精度はコンピュータの精度と入力データの精度にのみ依存します。
通常、代数的に解かれたモデルの精度はコンピュータの精度に近いです。

DCMが反復解法（例えば、次元をパラメータに解く場合）を使用する場合、現在の解像度値よりも精度の高い解に反復します。
通常、はるかに高い精度が達成されます。

DCMによって見つかった解は、少なくとも現在の解像度値と同じ精度であることが保証されています。

DCMは単位のない数値で動作し、アプリケーションがどの単位を使用するかを選択することができます。
したがって、アプリケーションは、DCMの単位がミリメートル、メートル、キロメートルに対応するかどうかを決定することが重要です。
解像度と単位を選択する際には、コンピュータの精度とデータの一貫性によって課せられる制約を考慮することが重要です。
以下のガイドラインに従うことで、問題を回避できます。

- DCMに渡されるデータの不正確さは、解像度よりもはるかに小さくする必要があります。
10倍のファクターを使用することをお勧めします。
例えば、2つの固定ジオメトリが一致することを意図している場合、解像度の1/10以内に一致するようにする必要があります。
- モデルの詳細のサイズは、解像度よりもはるかに大きくする必要があります。
再び、10倍のファクターをお勧めします。
例えば、2つの固定ジオメトリが異なることを意図している場合、それらの間の距離は解像度の10倍以上である必要があります。
- モデルのすべてのジオメトリは、サイズの長さのボックスに収まる必要があります。
ボックス（およびモデル）が原点を中心に配置されている必要はありません。

ただし、ジオメトリが原点から遠い場合（サイズと比較して）、すべての計算の精度が低下します。
これは、利用可能な小数点以下の桁数が限られているためです。

現在のDCMは、ジオメトリに使用される数値範囲に関する知識を持っていないため、モデルが原点から遠くないようにすることが推奨されます。

ほとんどの場合、上記のガイドラインに従わなくても問題は発生しません。
ただし、複雑なモデルでは、不正確さが蓄積され、一貫した解が見つからない場合があります。

DCMは、解像度の範囲内であっても、すべての寸法が満たされている場合でも、ジオメトリを移動する場合があります。これにより、より精度の高い解が得られます。

### 2.5.3 インクリメンタル評価

DCMがモデルを評価する際には、完全な方法またはインクリメンタルな方法のいずれかを使用することができます。
[1. DCMの概要](1._Introduction_to_the_DCM.md)の章で述べたように、完全な評価の最初のステップは、既存の図形のキラリティを分析し、モデルを解決する方法を決定することです。
2番目のステージでは、DCMは寸法を満たすために図形に適用する変換を計算します。
このプロセスには、いくつかの状況ではアルゴリズムの2番目のステージだけを使用して図形を再評価することができるという利点があります（時間を節約できます）。これはインクリメンタル評価と呼ばれます。

インクリメンタル評価を行うためには、寸法が追加または削除されていないことが必要です。
もし追加または削除が行われた場合、DCMはインクリメンタル評価ができないことを検出し、代わりに完全な評価が行われます。

インクリメンタル評価の前に、アプリケーションは寸法の値や線形方程式の係数を変更することが許可されています。
これは、DCMが繰り返し値が変更される解を見つける必要がある場合に特に有用です。
これには、部品のファミリーを生成したり、デザインのアニメーションを作成したりする場合があります。

インクリメンタル評価の新しい値をDCMが取得する方法は、Frustumインターフェースを介して行われます。
そのため、インクリメンタルに解決している場合、変更されない値やプロパティについては更新の問い合わせは行われない場合があります。
したがって、アプリケーションが自身のデータを変更したとしても、DCMはその変更を見ることができない場合があります。
インクリメンタル評価では変更が許可されないプロパティは、[2.5.3.3 モデルの変更後のインクリメンタル評価](#_Ref26282836)のセクションにリストされています。

モデルがインクリメンタルに評価される場合、ジオメトリが新しい位置に移動されていても、解のキラリティは保持されます。
これには2つの重要な結果があります。
まず、アプリケーションが解のキラリティを変更するためにジオメトリを移動したい場合は、完全な評価を使用する必要があります。
また、アプリケーションはジオメトリを移動させ、元のキラリティで解を見つけることも可能です。

インクリメンタル評価の前に固定ジオメトリが移動されると、DCMによって固定ジオメトリ間の暗黙の制約が破られる可能性があります。
[6.2 暗黙の制約](6.2._Implied_constraints.md)のセクションを参照してください。
そのため、インクリメンタル評価では有効な解が見つからない場合があります。

アプリケーションはインクリメンタル評価の前にジオメトリ（固定ジオメトリを含む）を移動することは禁止されていませんが、予測できない結果につながる可能性があるため、強く推奨されません。
[5.3 ジオメトリの移動とキラリティの保持](5.3._Moving_geometry_and_preserving_chirality.md)のセクションを参照してください。

アプリケーションが異なる解を見つけるためにDCMにキラリティの変更を要求した後でも、インクリメンタル評価を使用することができます。
以前のセクション[2.4 キラリティ](2.4._Chirality.md)を参照してください。

また、内部データ構造を変更しないDCM関数を呼び出した後にも、インクリメンタル評価を使用することができます。
通常、これらはDCMからデータを問い合わせるだけの関数であり、ステータス、debug\_xmit、および[16.13 モデル問い合わせ関数](16.13._Model_enquiry_functions.md)で説明されているエンティティ関連の関数です。

DCM関数：[re\_evaluate](16.8._Model_evaluation.md)

#### 2.5.3.1 モデルの分割

もしモデルに完全に切り離された2つ以上の図形グループが含まれている場合（つまり、共有する寸法がない場合）、1つのグループの変更は他のグループに影響を与えません。
DCMは、モデル内の切り離された領域を自動的に識別し、パーティションと呼ばれる内部構造に保持します。
各パーティションは他のパーティションと独立して解決することができます。
単一のパーティション内の図形や寸法の変更は他のパーティションの状態に影響を与える必要はありません。

例えば、2つの図形間に寸法を追加すると、DCMはその状態をリセットし、増分解決に使用される保存された解決策を無効にします。
しかし、モデルがパーティションに分割されている場合、寸法の追加は制約されている図形のパーティションのみをリセットします。

関数re_evaluateが呼び出されると、DCMはリセットされたパーティションに対して完全な評価を行う必要がありますが、他のパーティションは増分的に評価することができます。

DCMは、ノードの追加や削除などの操作中に自動的にパーティション構造を維持します。アプリケーションから特別なサポートは必要ありません。
例えば、2つの異なるパーティションの図形間に寸法が追加された場合、DCMはこれらを1つのパーティションに統合する必要があります。
この自動的なパーティション分割は、一連の連続的な評価を実行するためにDCMが持続的に使用される場合に、いくつかのモデルで大幅なパフォーマンス向上をもたらします。

#### 2.5.3.2 特定のパーティションの解決

メインのDCM解決関数（evaluate、re_evaluate、dynamic_evaluate、move_and_evaluate）は常に、モデル全体の完全なDCMソリューションが決定されていることを保証します。
これは、システム内のすべての制約と方程式が分析され、適切なステータスが与えられ、すべての図形と変数の位置と値が更新され、確認されることを意味します。

増分関数（re_evaluate、dynamic_evaluate）の場合、DCMは、以前の呼び出しで行われた場合には、その関数へのほとんどの作業を再利用し、大幅なパフォーマンスの向上を提供します。
ただし、以前の呼び出しが行われていない場合、DCMは引き続きすべての制約が考慮されるように、モデル全体を完全に解決します。

さらなるパフォーマンス向上のために、DCMは特定のパーティションに制限された解決関数も提供しています：evaluate_partitions、re_evaluate_partitions、dynamic_evaluate_partitions。
これらの関数は、アプリケーションによって指定された特定の図形に関連する制約と寸法のみを解決します。
関連のない制約、寸法、方程式は解決されず、接続されていない図形と変数の位置と値は決定されません。

これらの関数は、DCMがモデル内の制約の接続性に基づいて自動的に生成する内部パーティションで動作します。
アプリケーションは、これらのパーティションの構造を知って維持する必要はありませんが、機能を利用するためには、DCMノードの単純なリストを指定する必要があります。
DCMは、リストで参照されるすべてのパーティションを解決します。

DCMは、パーティション構造を生成するためにモデルの完全な構造を分析しているため、他のパーティションに関係なく指定された図形を完全に解決することができます。
パーティション固有の解決からの出力は、メインのDCM関数と同じです：DCMモデル内のノードのステータスや位置が変化する場合は、アプリケーションに対してFrustum呼び出しが行われます。
解決されていないパーティションに含まれるかどうかに関係なく、変更されていないノードは呼び出しを受けません。

パーティション固有の解決の主な制限は、モデルの残りの部分に対して分析が行われないことです。
したがって、DCMはアプリケーションに対して過定義のジオメトリについて警告することはできず、満たされていない制約を解決することはありません。
解決されていないパーティションのジオメトリと制約は、通常、解決前のステータス（解決済み、未知など）を保持します。

この機能は、満足された状態であることがわかっている大規模なモデルに特に有用です。過定義のジオメトリがない場合です。
典型的な例は、以前にDCMに読み込まれ、顧客のアプリケーションの同じリビジョンで解決されたモデルです。
アプリケーションデータが再度読み込まれ、DCMに追加されると、DCMソリューションが前のセッションと変わらないと仮定し、モデルの変更が行われる領域に解決を制限することができるかもしれません。

evaluate_partitionsまたはre_evaluate_partitionsへの複数の呼び出しを使用して、DCMモデル全体を段階的に解決し、全モデルバージョンのevaluateまたはre_evaluateと同等の状態にすることができます。
また、パーティション固有の元に戻す機能も提供されています。

DCM関数：[evaluate_partitions](16.10._Partition_specific_solving.md)

#### 2.5.3.3 DCM外でモデルを変更した後のインクリメンタル評価

インクリメンタル評価が行われる際、DCMは前回の完全評価以降に特定のプロパティが変更されていないと仮定します。
これは、特定のFrustum関数が呼び出されず、代わりにDCMはキャッシュされた値を使用することを意味します。
モデルがDCMの外部で変更された場合、これらの変更はDCMモデルに反映されず、予期しない結果が生じる可能性があります。

モデル定義データは、以下のルールに従ってグループ化することができます。

- 変更不可で、ノードが追加されたときにのみ設定されます。
ノードを削除して再追加することでのみ変更できます（完全評価を強制します）。

- インターフェース関数に渡される引数によって定義される接続性を含みます（例：add\_dのノードのリスト）。

- DCM\_g\_identifyやDCM\_dimension\_typeなどのFrustum関数によって定義されるプロパティを含みます。

- 完全評価時にのみ変更可能です。これらの場合、インターフェース関数を使用して変更する必要があります。

- ノードの固定およびロック状態。

- セットのメンバーシップ。

- 一部のスプラインプロパティ（replace\_splineを使用）。

- 完全評価が実行されているときにのみ変更可能です。これらの変更はresetを呼び出すか、完全な解決を強制する他のインターフェースの変更によってのみ行うことができます。
それ以外の場合、対応するFrustum関数は単に呼び出されません。

- ヘルプポイントが提供されるかどうか、ヘルプパラメータが提供されるかどうかなどの制約キラリティ制御プロパティ。

- 変換バイアス、ゼロダイヤモンドの解決選択などのソリューション制御の選択肢。

- 剛体寸法の値。



なお、バージョン74以前では、剛体寸法の値はインクリメンタル評価中にフラスタムから更新されていました。
以前の寸法値に基づく前提がもはや適用されない場合、これらの変更によって無効な解が生じる可能性があります。
たとえば、πラジアンの剛体角度は平行制約として扱われる場合があります。
インクリメンタルソルブ中に値が更新されると、その値は解の計算に使用されないか、他の平行制約が不満足になる可能性があります。
この動作に戻すオプションが提供されており、それに依存しているアプリケーションについては、[2.5.3.3.1 インクリメンタル評価における剛体寸法](#_Ref90913467)で詳細に説明されています。

- 剛体方程式の係数と定数。

- 固定ジオメトリの位置。

- 固定パラメータノードの値。

- 不等式の制限。

- パラメトリック周期性。

- インクリメンタル評価で変更可能です。

- 非剛体寸法の値。

- 自由ジオメトリの位置とサイズ。

- 一部のスプライン補間条件。

- 非剛体方程式の定数と係数。

- パラメトリック制限。

以下の表は、インクリメンタル評価の前に変更してはならないモデルのプロパティと対応するフラスタム関数のリストです。
このようなプロパティが変更された場合、アプリケーションはresetを呼び出さなければなりません。

モデルのプロパティ

関数

備考

ジオメトリのタイプ

[DCM\_g\_identify](Geometry definition functions.md)

add\_gでのみ問い合わせ

円の反転可能性

[DCM\_circle\_allow\_inversion](Geometry definition functions.md)

寸法のタイプ

[DCM\_dimension\_type](Basic dimension functions.md)

add\_dでのみ問い合わせ

等距離寸法のヘルプポイントが提供されるかどうか

[DCM\_equal\_distance\_dimension\_point](Basic dimension functions.md)

ヘルプポイントは変更可能ですが、DCM\_logicalの返り値は変更しないでください

方向付き距離情報

[DCM\_directed\_distance](Basic dimension functions.md)

アライメント

[DCM\_dd\_alignment](Basic dimension functions.md)

パターンの乗数

[DCM\_pattern\_multiplier](Basic dimension functions.md)

2Dパターンの乗数

[DCM\_pattern\_2d\_multipliers](Basic dimension functions.md)

パターンの開始値

[DCM\_pattern\_start\_value](Basic dimension functions.md)

2Dパターンの開始値

[DCM\_pattern\_2d\_start\_value](Basic dimension functions.md)

ゼロダイヤモンドの動作

[DCM\_resolve\_zero\_diamond](17.12._Miscellaneous_functions.md)

等導関数のアライメント

[DCM\_equal\_derivative\_alignment](Basic dimension functions.md)

接線のアライメント

[DCM\_tangent\_alignment](Basic dimension functions.md)

アライメント

[DCM\_dimension\_alignment](Basic dimension functions.md)

対称性のアライメント

[DCM\_symmetry\_alignment](Basic dimension functions.md)

法線のアライメント

[DCM\_normal\_alignment](Basic dimension functions.md)

変換バイアス

[DCM\_g\_transform\_bias](17.12._Miscellaneous_functions.md)

寸法の半空間

[DCM\_dimension\_half\_space](Basic dimension functions.md)

等距離の半空間

[DCM\_equal\_distance\_half\_space](Basic dimension functions.md)

剛性

[DCM\_dimension\_rigid](Basic dimension functions.md)

スケーリング中心

パラメトリックの周期性

[DCM\_parametric\_limits](Frustum functions for evaluated.md)

引数はパラメトリックの制限で、変更可能です。

パラメトリックの周期

[DCM\_parametric\_period](Frustum functions for evaluated.md)

パラメトリックの拡張データ

[DCM\_parametric\_extension\_data](Frustum functions for evaluated_1.md)

パラメトリックの拡張データ

[DCM\_parametric\_extension\_parameters](Frustum functions for evaluated_1.md)

等距離のヘルプパラメータが使用されているかどうか

[DCM\_equal\_distance\_dimension\_parameter](Frustum functions for evaluated_1.md)

返り値は変更しないでくださいが、ヘルプパラメータ自体は変更可能です

楕円のヘルプパラメータが使用されているかどうか

[DCM\_ellipse\_dimension\_parameter](Basic dimension functions.md)

返り値は変更しないでくださいが、ヘルプパラメータ自体は変更可能です

方程式のタイプ

[DCM\_equation\_type](Frustum functions for variables.md)

add\_e中のみ呼び出されます

線形方程式の定数の値

[DCM\_equation\_constant\_value](Frustum functions for variables.md)

方程式が剛体の場合、これは変更可能です

線形方程式の係数の値

[DCM\_equation\_coefficient\_value](Frustum functions for variables.md)

方程式が剛体の場合、これは変更可能です

不等式の最小値

[DCM\_inequality\_minimum](Frustum functions for variables.md)

不等式の最大値

[DCM\_inequality\_maximum](Frustum functions for variables.md)

表1：インクリメンタル評価の前に変更してはならないモデルのプロパティと対応するフラスタム関数のリスト

##### 2.5.3.3.1 インクリメンタル評価における剛体寸法

インクリメンタル評価中に、Frustum関数DCM\_dimension\_valueは通常の寸法の値を更新するために呼び出されます。

DCMバージョン74以降では、剛体寸法に対してこの関数は呼び出されません。
アプリケーションが剛体寸法の値を更新し、インクリメンタル評価を実行する場合、DCMはその変更を無視します。
これに該当する寸法は、以下のものです。

- 距離
- 方向付き距離
- 角度
- 円の半径
- 楕円の長半径
- 楕円の短半径
- 弧の長さ
- 曲線の長さ
- 寸法付き円錐曲線のρ値
- 1Dおよび2Dパターンの値

インクリメンタル評価中に剛体寸法の値を変更するためには、アプリケーションはリセットを呼び出すか、オプションDCM\_OPKEY\_INCREMENTAL\_RIGID\_DIMENSION\_UPDATEの値をDCM\_OPVAL\_ONに設定する必要があります。

### 2.5.4 図形のドラッグ

デザインがスケッチされ、おそらくいくつかの論理的な制約が定義されているが、寸法値が指定されていない（もしくはほとんど指定されていない）場合、デザインの一部を他の部分に対して移動したいということはよくあります。
DCMは、図形が解決されている間に適用する変換を指定するための関数を提供することで、これをサポートしています。
これらの関数により、拘束不足のデザインに対して洗練された変更が可能になります。

この種の操作のために使用される用語は「ドラッグ」と呼ばれます。
自由な図形をドラッグすると、部分的に拘束不足のデザインにのみ影響を与えます。
ドラッグの実装方法に関連する以下の考慮事項があります：

- デザイン内の任意の数とすべての種類の図形を変換することができます。固定された図形や凍結された図形も含まれます。ただし、多数の図形をドラッグすると処理が遅くなる場合があります。
- 変換（各図形ごとに同じである必要はありません）は、平行移動、回転、半径の変更（円や楕円の場合）の組み合わせであることができます。また、パラメトリック曲線の形状を更新するためのインターフェースも提供されています。
- ドラッグ中、DCMは指定された図形を指定された変換で変形します（可能な場合）。デザインの他の図形も変形され、定義された寸法や制約が違反しないようにします。
- ドラッグ中に、ドラッグ時の解決モードとして[2.5.6 拘束不足の図形の解決制御](#_Ref498157745)で説明されている4つのモードのいずれかをアプリケーションが使用することができます。デフォルト（および推奨）のモードは、最小移動モードです。
- 一部の場合、指定された図形には与えられた変換を受け入れるために十分な自由度がない場合があります。アプリケーションは、これらの場合に必要な動作をDCMに通知し、DCMはそれが達成されたかどうかを返します。[16. The DCM Interface](16._The_DCM_Interface.md)の関数dynamic\_evaluateの説明を参照してください。
- 通常、ドラッグは対話型の多段階操作であり、モデルはいくつかの小さなステップで更新されます。各ステージで、アプリケーションは現在の位置を使用するか、前の位置に戻すか、または元の位置に戻すかのオプションがあります。
- 特定のアプリケーションでは、関数dynamic\_evaluate\_partitionsのパーティション固有のバージョンが適している場合があります。これにより、DCMの解決はドラッグ図形に関連するジオメトリに制限されます。

DCM関数：[dynamic\_evaluate](16.9._Dragging_geometry.md)

### 2.5.5 代数的および非代数的な解法

点、直線、円の間の寸法を含むほとんどの実用的な寸法設定は、標準の図板技術を使用して構築することができます。
すべてのこのような設定は、数値的な手法を使用せずにDCMによって解決することができ、代数的と呼ばれます。
数値的な手法を必要とする寸法設定は、非代数的と呼ばれます。
これらは標準の図板技術を使用して構築することはできません。

可能な限り、DCMは非代数的または数値的な手法よりも代数的な解法を優先して使用します。
代数的な解法が数値的な手法よりも優れている理由はいくつかあります。

- 代数的に解く場合、設計のキラリティは常に保持されます。寸法の変化がどれほど大きくても、数値的な手法では解が飛び出してヒステリシスを引き起こす可能性があります。これは、変更をより小さなインクリメントで行うことでほとんど常に克服することができます。
- 代数的な手法は数値的な手法よりも本質的に精度が高いです。
- 代数的な手法は一般的に数値的な手法よりもはるかに高速です。

代数的な手法では解けない点と直線を含むデザインの単純な例は次のとおりです。

![fig3_numerical.bmp](../Resources/Images/2ddcm_manual/Evaluating the model_1.png)

図3：代数的に解けない例

DCMは通常、代数的に解けないモデルに対してバックアップとして数値的な手法を使用するデフォルトモードで使用されます。
ただし、この動作を変更して、二次的な数値処理を完全に防止するか、部分的にのみ使用することも可能です。
この機能は、パフォーマンスが最優先の場合に使用できます。

アプリケーションがデフォルトの解法方法を変更することを推奨する状況の1つは、モデルの自動寸法設定中です。
自動寸法設定プロセスでは、残りの自由度が多いジオメトリが自動的に完全に寸法設定され、モデルが過定義にならないようにします。
通常、スケッチ内の単一のジオメトリには非常に多くの可能な寸法があります。
選択される寸法は、パフォーマンスと解決の振る舞いに大きな影響を与えることがあります。

そのため、一部の状況では、顧客は自動寸法呼び出しの間に非代数的な解法を無効にすることを選択します。
これにより、DCMは数値的な解法を必要とする寸法設定を選択しないようになります。
それらの寸法が入力オプションで可能であり、自動寸法の重みを使用して優先度が付けられている場合でも、モデルが非代数的になるため、DCMはそれらを適用しません。
自動寸法呼び出しが終了すると、通常はデフォルトの動作（つまり、非代数的な解法を再度有効にする）に戻り、数値的な手法が必要な他のユーザー指定の寸法が機能するようにします。

このアプローチは、初期寸法のないモデル（つまり、初期の自由度を除去するDCMの論理的な制約のみが存在するモデル）ではうまく機能します。ただし、既に非代数的な領域を持つモデルでは使用できません。これは、既にいくつかの寸法があるモデルで発生する可能性があります。

非代数的な解法は、バージョン68.0で導入された自動寸法インターフェースを使用する場合にのみ、アプリケーションが自動的に有効にされます。
特異構成診断を回避する機能を使用すると、非代数的な寸法設定を避けることができますが、非代数的な解法を有効にした通常のDCM解法と比較して、追加のパフォーマンスペナルティが発生することに注意してください。

DCM関数：[set\_option](16.2._Configure_global_DCM_behaviour.md)

### 2.5.6 拘束不足図形の解決制御

DCMは、ユーザーが拘束不足の図形で作業できるように設計されています。
まず、デザインの形状をスケッチし、論理的な拘束と寸法を指定して洗練させることが非常に自然です。
拘束不足の図形は自由度が残っているため、解決策の範囲があります。
DCMは、拘束不足の図形の解決に影響を与えるための3つの方法を提供しています：解決モード、優先図形、変換バイアス。

各解決モードは、拘束不足の図形を異なる方法で扱うため、アプリケーションはタスクに最も適したものを選択できます。
たとえば、重み付き標準解決モードは、move\_and\_evaluate関数のデフォルトであり、推奨されるモードです。
これにより、アプリケーションによって行われる図形位置の変更に優先順位が付けられます。

優先図形は、解決モードと組み合わせて、拘束不足の図形の解決方法をより詳細に制御するために使用されます。
解決モードを指定するだけでなく、アプリケーションは解決時に優先度の高いジオメトリの配列を指定することもできます。
ジオメトリ配列は常に配列の最初の要素に最も高い優先度を与えます。
解決モードによっては、配列の要素が移動する可能性が高くなるか、同じ位置に留まる可能性が高くなります。
効果は、以下の各解決モードについて説明されています。

変換バイアス機能を使用すると、アプリケーションは変更するかしないかを優先的に指定できます。
このバイアス情報は定量的なものである場合もあります。
DCMは、解決策を見つけるために必要な場合にのみバイアス情報を上書きします。
一般的に、変換バイアスを使用すると、アプリケーションはどのジオメトリが移動するかをより制御できます。

DCMにすでにすべての寸法が満たされている構成を解決するように要求された場合、何も変更されません。
以下に説明するオプションは、未解決の寸法がある場合にのみ効果があります。

5つの解決モードのそれぞれは、各評価関数（evaluate、re-evaluate、dynamic\_evaluate、move\_and\_evaluate）と組み合わせて使用できます。ただし、ほとんどの場合は各関数のデフォルトの解決モードを使用することが推奨されます。
解決モードは次のとおりです。

標準

拘束不足の図形を剛体として移動します。

evaluateおよびre-evaluateのデフォルトモードです。

重み付き標準

選択した図形を配置するためにジオメトリを移動します。

move\_and\_evaluateのデフォルトモードです。

局所化

未解決の拘束に近いジオメトリのみを移動し、寸法とドラッグされたジオメトリを変更します。

dynamic\_evaluateの新規ユーザーやevaluate/re\_evaluateでのローカルな変更に推奨されます。

注：解決シーケンスの寿命中に定数値の寸法を剛体にする場合に最適です。

最小移動

最小数のジオメトリを移動します。

dynamic\_evaluateでのドラッグのデフォルトモードです。

リラクゼーション

緩和法を使用して解決します。

多くのジオメトリを異なる量移動します。

解決が遠いモデルを解決するために使用されます。

通常、最も遅い解決モードです。

標準の解決方法で解決策が見つからない場合に推奨されます。

#### 2.5.6.1 標準解決モード

標準解決モードでは、DCMはモデルを解決する過程で、図形の変換を伝播させます。
また、拘束不足の図形を特定の順序で変更します。
この順序は、各図形を寸法を満たすために最小限の変更で変更するように選択されます。
例えば、固定点と直線が一定の距離で寸法指定されている場合、DCMは寸法を満たすために直線を移動させますが、角度は変更しません。
一般的に、DCMは円の半径を維持し、その後に直線の角度を維持しようとします。

標準解決モードを使用する場合、DCMは図形の元の位置を考慮に入れます。
そのため、以下で説明する最小移動および重み付け標準解決モードよりも、この解決モードを使用すると解が見つかる可能性が高くなります。

標準解決を使用する場合、アプリケーションは図形の配列を指定することができます。
これの詳細については、[2.5.6.7 ソフト参照図形](#_Ref73871708)のセクションを参照してください。

#### 2.5.6.2 重み付き標準解決モード

重み付き標準解決は、優先度ジオメトリ配列の使用方法が標準解決と異なります。
標準解決では、配列内のジオメトリによって各非連結部分の自由度は3つだけが影響を受けます。
しかし、重み付き標準解決では、DCMはモデルのすべての自由度を使用して、配列内のジオメトリの位置決めに影響を与えることができます。
つまり、重み付き標準解決では、非連結部分の剛体的な外観を維持しようとはしません。

この解決モードは、個々のジオメトリの位置決めに対してアプリケーションにより大きな制御を提供します。
特に、標準解決では優先度配列の最初の1つまたは2つの要素しか使用しない場合でも、重み付き標準解決ではより大きな配列内のすべてのジオメトリを位置決めすることができます（解が可能な場合）。

この解決モードは、アプリケーションがモデル内の一部のジオメトリを特定の位置に配置したい場合に便利です。
これは、ジオメトリが最初に追加された後に評価関数を使用する場合や、ジオメトリを再配置するためにmove_and_evaluate関数を使用する場合などです。
ただし、このモードの欠点は、DCMが一部の解を見つけることができなくなることです。
つまり、標準モードで解決できるモデルでも、重み付き標準モードでは解決できないモデルがあるということです。
また、拘束不足部分の形状は、複数のジオメトリが優先度配列に含まれている場合に変更される可能性が高くなります。

[図4：重み付き標準解決の例](#_Ref497716078)は、標準解決と重み付き標準解決の違いを示しています。
このモデルには、固定されたジオメトリ（垂直線）と拘束不足のジオメトリ（長方形と点）が、初期の解決位置に含まれています。
アプリケーションが点を右に移動して評価すると、標準解決モードでは元の位置にスナップバックされます。
点をソフト参照として提供しても、固定ジオメトリへの接続が優先されるため、ボックスと点を剛体として維持しようとするDCMの影響が優先されます。
しかし、重み付き標準解決では、点を優先度配列に提供することで、下の所望の位置を得ることができます。

![fig4_weighted.bmp](../Resources/Images/2ddcm_manual/Evaluating the model_2.png)

図4：重み付き標準解決の例

#### 2.5.6.3 ローカライズされた解決モード

ローカライズされた解決は、満たされていない拘束条件や非剛体寸法またはドラッグされた図形に最も近い図形を特定し、それらの拘束条件を満たし、入力変換を達成するために変更できる図形を特定します。これにより、より遠いモデル要素は変更されません。

最も近いという定義は、主にモデルの接続性（満たされていないまたは変更中のd\_nodeまたは変更中のg\_nodeからのステップ数）に基づいていますが、必要に応じて幾何学的な距離も使用されます。
標準の解決とは異なり、変更は接続された図形に伝播されません。

この解決戦略は、変更入力を解決するためのより小さな移動をもたらし、変更を駆動する入力に近い一部のg\_nodeのみが変換されるはずです。
その結果、このモードは、大きなモデルへの局所的な変更に特に適しており、ユーザーが完全なDCMモデルのサブセットのみを表示している場合、変更は表示されている要素にのみ適用される可能性が高くなります。

DCMの評価中、この解決モードでもすべての図形の位置が計算されるため、変換が制約の精度を向上させるために任意の図形に出力される可能性があります。
ただし、このモードでは、これらの変更は非常に小さなものであると予想されます。

DCMは、次の基準を使用して、どの図形を移動するかを決定します。

- 最も重要なのは、次の「シード」ケースで、優先度は同じです：

- 入力変換が与えられた図形（move\_and\_evaluate/dynamic\_evaluate）
- 満たされていない論理的な拘束条件を持つ図形
- 満たされていない剛性寸法を持つ図形
- 値を持つ寸法を持つ図形（満たされているかどうかに関係なく）

- 上記の「シード」に近い図形

- まず、図形の接続性によって測定し、制約の数で近さを測定します。
- この場合、距離が等しい場合は、空間的に近い図形を選択します。
- 非対称な解決を避けるために、等距離の図形が1つだけではなく、両方が移動される場合があります。

このモードで評価する際に、アプリケーションが優先度のある図形や変換のバイアスを指定することはお勧めしません。
アプリケーションは、DCMがどの図形を移動するかを決定するようにする必要があります。

剛性寸法と非剛性寸法の扱いは、ローカライズされた解決モードから適切な動作を得るために非常に重要です。
アプリケーションは、次のローカライズされた解決のシーケンス中に一定の値として考慮される寸法値をDCMに伝えるために、寸法の剛性を使用することが期待されています。
前述のように、非剛性寸法は変更を局所化するためのシードとして考慮されるため、最適なローカル解決を得るためには、変更される値のみを非剛性のままにし、他の値はその解決サイクル中に剛性として定義する必要があります。

#### 2.5.6.4 最小移動解決モード

最小移動解決が指定された場合、DCMは図形の変換をモデル全体に伝播しません。
また、モデルの特定の部分周辺で変更を局所化する解決策を見つけます。
アプリケーションは、変更を局所化するモデル上の場所を指定するか、DCMにこの選択を任せることができます。
DCMに選択を任せる場合、この解決モードでは最小限の数の図形が移動します。

DCMは、以下の基準でどの図形を移動するかを決定します：

- モデルがドラッグされている場合、変換されている図形が他の図形よりも優先して移動されます。
- 寸法や拘束が現在の図形の位置で満たされていない場合、DCMは寸法や拘束の端にある図形を優先的に移動します。

このモードを使用する際に、アプリケーションが優先的に移動する図形を指定することはお勧めしません。
アプリケーションは、DCMに図形の移動を決定させるべきです。

なお、局所解決モードとは異なり、DCMは最小移動モードで解決する際に、非剛体（通常の）寸法の値がアプリケーションによって変更されるかどうかについての仮定を行います。
初期状態で寸法が満たされている場合、接続された図形は将来の増分解決において移動する可能性が低いと見なされません。
これにより、寸法が満たされていない場所の変更を最小限に抑えることができますが、対象寸法を使用しない場合に局所的な計算の失敗を引き起こす可能性もあります。

[図5：異なる解決モードの効果。](#_Ref497733119)は、標準の解決モードで寸法を変更し、最小移動解決モードを使用して図形をドラッグすることの効果を示しています。

![fig5_solving_modes.bmp](../Resources/Images/2ddcm_manual/Evaluating the model_3.png)

図5：異なる解決モードの効果。

#### 2.5.6.5 リラクゼーション解法モード

その名前が示すように、リラクゼーション解法モードは数値的なリラクゼーション法によって解を見つけます。
これにより、通常、他の解法モードよりも多くの図形が相対的に移動することになります。
使用されるアルゴリズムは、移動量の二乗の和を近似的に最小化しようとし、その結果、すべての図形を同じ程度移動させます。

この種の解法の利点は、他の3つのモードでは解を見つけることができない場合に解を見つけることができることです。
これの例として、境界線の単純な連鎖があります。この連鎖を「伸ばそう」とすると、いくつかの図形が移動する必要があります。
数値解法は通常、他の3つのモードよりも遅いです。

リラクゼーション解法は、標準解法と同じように、優先された図形リストをソフトな参照として使用します。

#### 2.5.6.6 変換バイアス

任意の解決モードを使用して評価を行う際、アプリケーションは図形の移動を通知するために変換バイアスを使用することがあります。
DCMは、図形を移動する必要があると判断した場合、移動する可能性のある各図形ノードに対してバイアスのタイプと値を問い合わせます。
この問い合わせは、評価中にフラスタムを介して行われます。
可能な場合、DCMはアプリケーションの優先順位に従って図形を移動し、解決位置に到達します。
ただし、解決が見つからなくなる可能性がある場合、DCMは指定されたバイアスを上書きすることがあります。
これは、複数の解が存在する未定義モデルに対してのみ有効です。

変換バイアスの指定は、重み付き標準解決モードの使用と似ています。
ただし、変換バイアスは、移動するか静止するかを指定する図形の完全な順序をアプリケーションが指定できるため、より柔軟性があります。
変換バイアスは、DCM変数にも指定でき、値が変更されるかどうかに影響を与えることができます。
変数と図形のバイアス値は等しく比較されるため、バイアスを使用して、方程式を図形の移動または変数の変更によって解決するかどうかを選択することが可能です。

変換バイアスは、すべての解決モードおよび評価の種類（評価、再評価、動的評価、移動および評価）で使用することができます。ただし、いくつかの制限があります：

- ローカライズド解決モードでは、変換バイアスは推奨されません。
- リラクゼーション解決の性質上、変換バイアスが効果を持つことはまれです。
- インクリメンタル評価では変換バイアスは問い合わせられません。再評価および動的評価の場合、インクリメンタルな解が可能な場合、移動する図形は前回の完全な評価によって決定されます。
- 動的評価および移動および評価中にアプリケーションが指定した図形の移動は、バイアスよりも優先されます。
- ソフト参照は変換バイアスを上書きすることができるため、これらの機能を同時に使用することは推奨されません。

フラスタム関数: [DCM\_g\_transform\_bias](17.12._Miscellaneous_functions.md)

#### 2.5.6.7 ソフト参照図形

一般的に、固定された図形のないDCMモデルは3つの自由度を持ちます。
固定された図形のないモデルが変更される場合（例えば、寸法の値を変更することによって）、アプリケーションはソフト参照図形を使用して結果に影響を与えることができます。

ソフト参照として選択された任意の図形は、DCMに対して図形を変更しないようにする指示として解釈されます。もし変更が不可能な場合は、できるだけ少ない移動で済ませるべきです。
内部的には、DCMはソフト参照を考慮せずにモデルを解決し、残りの自由度を使用してソフト参照図形の位置を維持しようとします。
つまり、モデルを平行移動や回転させることはあっても、実際の形状は変えません。

DCMはソフト参照図形を配列として受け取ります。
もしDCMがソフト参照図形を変更する必要がある場合、配列の最初の図形は移動される可能性が最も低く、最後の図形は最も移動される可能性が高いです。

ソフト参照が使用される前に、DCMはモデルの一部が分離しているかどうかを特定します。
もしモデルの2つの部分が直接的または間接的に寸法によって接続されていない場合、それらは分離しています。
さらに、固定された図形に寸法でのみ接続されている場合も、部分は分離しています。

ソフト参照アルゴリズムは、モデルの各分離した部分に個別に適用されるため、アプリケーションはモデルの各分離した部分に複数のソフト参照図形を指定することができます。
これらの自由度がすべて使われた後、残りのソフト参照図形は無視され、DCMによって移動される可能性があります。
通常、モデルの各分離した部分には数個のソフト参照図形しか使用されませんが、指定された数が多くても重大なパフォーマンスのオーバーヘッドはありません。

ソフト参照は、モデルの一部に固定された図形がある場合でも、まだいくつかの自由度が残っている部分で使用されます。
例えば、分離した部分に固定された点が1つある場合、回転の自由度はソフト参照図形を満たすために使用できます。

#### 2.5.6.8 解決モードの選択

前述の通り、ほとんどの場合はデフォルトの解決モードを使用することが推奨されています。
ただし、必要な動作が得られる場合は、アプリケーションは他のモードを選択することも自由です。

上記のアドバイスからの例外は、ドラッグ操作です。デフォルトでは、後方互換性のために最小移動モードが使用されます。
ただし、新しい統合の場合は、定数値の寸法を剛体として定義する指示に従う限り、ローカライズされた解決がほとんどの目的に対してより良い体験を提供すると考えられています。

上記で説明したすべての解決モードは、拘束不足モデルにのみ影響を与えます。
DCMは拘束不足モデルを解決するために設計されていますが、可能な限り望ましい動作を得るために、追加の寸法を追加することが通常好ましいです。

一部の未定義モデルでは、解決モードの選択によって、特定の開始位置が成功するかどうかが影響を受けます。
たとえば、最小移動解決は、標準解決で解決するモデルでは解決できない場合があります（DCM\_NOT\_CONSISTENTのステータスが表示されます）。なぜなら、選択された解決方法では移動範囲が制限されているため、より多くの図形を移動することですべての拘束条件を満たすことができるからです。

### 2.5.7 寸法設定の問題

時折、DCMは寸法設定の問題により、すべての拘束条件を満たすための図形の位置を計算できないことがあります。
このような場合、DCMは適切なステータスコードをアプリケーションに渡して、問題のある箇所を説明します。
発生する可能性のある問題は以下の通りです（詳細は第14章「ステータスコード」を参照）：

- 一貫性がない \- デザインには正しい数と種類の寸法があるが、一貫性がない場合があります。
例えば、辺の長さが50、50、120の三角形です。
- 過拘束 \- 利用可能な図形の自由度に対して、寸法が多すぎます。
ただし、第2.3節「自由度」で説明したように、
第2.7.2節「過拘束だが一貫したモデル」を参照してください。
- 拘束不足 \- 利用可能な図形の自由度をすべて使い切るための寸法や拘束条件が不足しています。
この場合、DCMは図形がまだ持っている自由度について詳細な情報を出力することができます（例えば、
円の半径が定義されていない場合など）。拘束不足の図形はDCMにとって問題ではなく、モデルを解決します。
- 特異な拘束不足 - モデルには、すべての自由度を取り除くための正しい数の拘束条件を持つ図形が含まれていますが、寸法や位置、形状の特定の値のために、図形は実際には複数の位置に配置できます。
DCMはこのようなモデルを解決するのに困難はありませんが、さらなる拘束条件を追加してもこのような図形を完全に定義することは常に可能ではないため、アプリケーションは通常の拘束不足の図形とは異なる方法でこれらのケースを扱う必要があります。

DCMは、寸法が追加される前にアプリケーションがデータが過拘束になるかどうかをチェックするための関数を提供しています。
これらの関数は、寸法を実際に適用して図形を評価するよりもはるかに高速に動作します。
また、モデル内のすべての過拘束データを見つけることは比較的高コストな操作であり、DCMのオプションにより、データが必要ない場合にはこの解析を回避することができます。

DCM関数：[set_option](16.2._Configure_global_DCM_behaviour.md)
