# 11. オフセットと曲線のコピー

アプリケーションでは、曲線間のオフセット関係をサポートすることがよくあります。これは、ある図形から一定の距離だけずらした図形の集合を表します。直線や円の場合、オフセット曲線は別の直線や円になります。しかし、他の図形の場合、オフセット曲線は解析的な図形ではありません。これらの図形では、オフセット曲線タイプを使用してオフセット関係を表すことができます。

オフセット関係は、アプリケーションでオフセットプロファイルをサポートするためによく使用されます。これは、接続された図形の集合を指定された距離だけずらして新しいプロファイルを形成するものです。DCMは等距離制約を使用してこのようなプロファイルを一部サポートするために使用できます。ただし、DCMは無限の図形にのみ対応しているため、プロファイルの管理には完全なサポートを提供しません。オフセット図形が交差したり、曲線間に隙間がある場合には、アプリケーションが対処する必要があります。

高度なオフセットプロファイルの管理が必要な開発者は、プロファイルジオメトリマネージャーコンポーネントを調査することをお勧めします。PGMはエッジ、ループ、プロファイルなどの有界ジオメトリに対して操作を行い、オープンまたはクローズドのプロファイルのオフセットを生成する機能を提供し、オフセットプロファイルが自己交差や隙間なしで完全に接続されることを保証します。DCMは無限のオフセット図形にのみ関与しています。そのため、オフセット距離が大きすぎる場合、プロファイルが自己交差する可能性があり、アプリケーションは適切な処置を取る必要があります。

### 11.1.1 オフセット図形の作成

追加するオフセット図形の種類は、オフセットする図形によって異なります。

- 直線

直線のオフセットは、もう一つの平行な直線です。
- 円

ほとんどの場合、円弧のオフセットは同心円です。
円の半径と同じ距離で内側にオフセットすると、半径がゼロの円になります。
ただし、円の半径よりも大きな距離で内側にオフセットすることはできません。
なぜなら、これは負の半径の円を作成することを意味し、DCMではサポートされていないからです。
- 点

点は円にオフセットできます。
アプリケーションは、2つのオフセット直線の間の隙間を埋めるために点をオフセットすることを望む場合があります。
- 楕円、スプライン、円錐曲線、評価パラメトリック曲線

これらの曲線のオフセットは、特別な図形タイプであるオフセット曲線として作成されます。
これらのオフセット曲線のオフセットも作成することが可能です。
オフセット曲線についての詳細は、セクション[11.1.3 楕円とパラメトリック曲線の正確なオフセット](#_Ref279073227)を参照してください。

オリジナルの図形の正しい側にオフセット図形を作成することがアプリケーションにとって望ましいです。
これにより、DCMは正しいキラリティでモデルを解決することが保証されます。
ほとんどの場合、オリジナルの図形の正しい側にない1つ以上のオフセット図形のキラリティを変更することが可能です。
これについては、DCMのchange\_chirality関数の詳細を参照してください。

点、直線、円の場合、オフセット図形は通常のadd\_gを使用してDCMに追加されます。
オフセット曲線は異なる関数を使用して追加されます。

### 11.1.2 オフセット曲線の拘束

オフセット曲線は通常、等距離の拘束を使用して親曲線に拘束されます。
等距離の拘束は、2つの図形の間に配置され、最初のペアと2番目のペアの間の距離が同じであることを意味します。
対応する円または円とその対応する点の間に同心円の拘束を追加する必要もあります。
直線とそのオフセットの間に平行な拘束を追加する必要はありません-これは等距離の拘束によって暗黙的に示されます。

実際のオフセット距離を指定するには、アプリケーションはプロファイル内の2つの図形間に単一の距離寸法を追加することができます。
または、オフセット距離を未定義のままにすることもできます。
ただし、アプリケーションが円を点にオフセットした場合、オフセット距離は円の半径に独立して指定することはできません。

DCMは、同心円になった場合にのみ、2つの円または円と点の間の等距離の拘束を解決します。
これは基本的な要件ではありませんが、現在のリリースのDCMの制約です。

アプリケーションは、正しいキラリティでオフセット曲線を作成する必要があります。
解析型の場合、それらをベース曲線の右側に配置するだけで十分です。
オフセット曲線のキラリティは、オフセット曲線がフラスタムを介して作成されるときに指定されます。

### 11.1.3 円錐曲線とパラメトリックの正確なオフセット

DCMは、円錐曲線やパラメトリック曲線の正確なオフセットを作成するために使用できます。
この曲線の種類はオフセット曲線と呼ばれ、関数add\_offset\_gを使用してDCMに追加されます。
オフセット曲線に対しては、Frustum関数DCM\_g\_identifyは呼び出されず、この図形にはDCM\_g\_typeが定義されていません。
オフセット曲線は方向性があります。オフセット曲線は、そのオフセットのルート曲線と同じ方向を持ちます。

オフセット曲線を定義するために使用される曲線は、オフセットの親として知られています。
他のオフセット曲線からオフセット曲線を作成することも可能です。つまり、オフセット曲線は他のオフセット曲線の親になることができます。
元の楕円またはパラメトリック曲線は、オフセットのルートとして知られています。

![fig53_offset_curves.bmp](../Resources/Images/2ddcm_manual/2ddcm_manual_3.png)

図61: オフセット曲線の例

[図61: オフセット曲線の例](#_Ref480177712)には、オフセット曲線のいくつかの例が示されています。
曲線offset\_pはパラメトリック曲線からオフセットされています。
曲線offset\_e1は楕円のオフセットです。
曲線offset\_e2はoffset\_e1からオフセットされています。したがって、offset\_e1とoffset\_e2は同じオフセットルート（楕円）を持っています。

オフセット曲線は、オフセットルートへの任意の中間親を介したオフセット距離の合計を使用して、オフセットルートから生成されます。
したがって、上記の例では、楕円はoffset\_e1とoffset\_e2の両方の生成元であり、offset\_e1とoffset\_e2のオフセット距離の合計がoffset\_e1の位置を評価するために使用されます。オフセット曲線の形状を評価するために必要な距離値は、オフセットルートへの距離であるため、その値をクエリするための特定の関数（query\_offset\_distance）が提供されています。

これは、オフセットのオフセットのオフセット曲線の形状が、直接のオフセットと同じであることを保証するものではないことを意味します。特に自己交差が発生する場合には。しかし、これは、これらのオフセットの評価が直接のオフセットよりも複雑ではないことを意味します。また、等しい符号の距離を持つオフセットのオフセットは、元のオフセットルートと重なります。

オフセット曲線のプロパティは、そのオフセットルートとアプリケーションによって追加される任意の曲線拡張に依存します（セクション[7.5 曲線拡張](7.5._Curve_extensions.md)を参照）。
非周期的なパラメトリック曲線のオフセットも非周期的です。
周期的なパラメトリック曲線のオフセットは、パラメトリック曲線が接続連続である場合にのみ周期的です。
オフセット曲線は、ルート曲線と同じ方法でパラメータ化されます。
ルート曲線が評価されたパラメトリックである場合、パラメトリック評価器はルート曲線のみに対して呼び出されます。
スプラインや円錐曲線のオフセットは内部で定義され、パラメトリック評価器は呼び出されません。

DCMは、オフセット曲線に関する次の情報を問い合わせます：

- Frustum関数DCM\_offset\_orientationを呼び出すことによって、親に対する初期方向性。
- Frustum関数DCM\_offset\_distanceを呼び出すことによって、オフセット曲線と親の初期距離。

初期距離と初期方向性の両方は、オフセット曲線の開始位置を指定するためにのみ使用されます。
これらは所望の解決策を指定しません。
アプリケーションは、所望の解決策を指定するために制約と寸法を追加する必要があります。
評価の最後に、DCMはFrustum関数DCM\_update\_offset\_dataを呼び出して、新しい方向性と距離を出力します。

オフセット曲線に関するDCMからアプリケーションに与えられる情報は、オフセット距離とオフセット側のみです。
アプリケーションは、曲線上の点を見つける責任があります（たとえば、描画するために）が、これらは元の曲線とオフセット距離と側面から簡単に見つけることができます。
同様に、オフセット曲線に拡張がある場合、アプリケーションは、拡張の形状を計算する必要があります。これは、拡張の開始時のベース曲線のプロパティ（つまり、位置と1次導関数）とオフセット距離と側面に基づいて行われます。

オフセット曲線が親曲線から十分に離れている場合、自己交差や不連続性を持つオフセット曲線を作成することができます。
[図62: 自己交差するオフセット曲線](#_Ref480177790)には、そのようなオフセットパラメトリック曲線と内側にオフセットされた楕円が示されています。
これらの不連続な曲線は、特にこれらの不連続性の領域に制約がある場合、解の信頼性の問題のために推奨されません。
同様に、接続不連続性を持つパラメトリックのオフセットも避けるべきです。

DCM関数：[add\_offset\_g](16.3._Defining_the_model_data.md)

Frustum関数：[DCM\_offset\_orientation](17.8._Frustum_functions_for_offset_and_copy_curves.md)

### 11.1.4 オフセット曲線の消去

オフセット曲線は、関数eraseを使用してDCMから消去されます。
曲線を消去すると、DCMは自動的にそれにオフセットされた曲線も削除します。
例えば、offset\_e1を消去すると、DCMは上記の[図61：オフセット曲線の例](#_Ref480177712)においてもoffset\_e2を消去します。
DCMは、消去された曲線に関連する寸法や拘束も消去します。

DCM関数：[erase](16.3._Defining_the_model_data.md)

11.1.5 寸法と拘束によるオフセット曲線

オフセット曲線と同じオフセットルートを持たない他の図形との間には、以下の種類の寸法と拘束を適用することができます：

- 点に対する一致拘束
- 他の方向性のある図形に対する平行拘束
- 角度寸法
- ロック拘束
- 他の曲線に対する接線拘束
- 他の曲線に対する法線拘束
- 他の図形に対する距離寸法

オフセット曲線への寸法と拘束には、オフセットルートがパラメトリックな場合、ヘルプパラメータが必要です。
オフセット曲線は、ルート曲線と同じパラメータ化を持ちます。

オフセットルートが楕円の場合、オフセット曲線への寸法と拘束には常にヘルプポイントが必要です。

オフセットルートが同じオフセットルート（オフセットルート自体を含む）を持つ他の曲線との間には、以下の寸法と拘束を適用することができます。これらの拘束や寸法は、オフセット曲線上の特定の位置には適用されず、代わりに曲線全体に適用されます。
したがって、これらの場合にはヘルプポイントやヘルプパラメータは必要ありません：

- 等距離拘束
- 一致拘束
- 距離寸法

### 11.1.6 オフセット距離のドラッグ操作

オフセット曲線のオフセット距離がモデルの制約によって定義されていない場合、アプリケーションはドラッグ操作などを通じてオフセット距離を動的に変更することができます。

関数dynamic_evaluateを使用してオフセット距離を変動させ、インクリメンタルな解決を行うことができます。

11.1.7 楕円とパラメトリックの近似オフセット

上記で説明したオフセット曲線タイプは、DCMが楕円またはパラメトリック曲線の正確なオフセットを表現できるようにします。
正確なオフセット曲線は、プロファイルの加工に使用される円筒カッターのパスをモデリングするなど、一部のアプリケーションで重要です。
ただし、正確なオフセットが必要でない場合、アプリケーションは既存のスプラインなどの曲線タイプでパラメトリック曲線または楕円の近似オフセットを表現することが可能です。
以下の手順は、これを行うための1つの可能な方法を説明しています：

- ステップ1 - DCMでオフセット曲線を生成します。

アプリケーションは、この曲線のためのデータ構造を作成する必要がありますが、これはDCMフラスタム呼び出しをサポートするためだけに必要です。
- ステップ2 - オフセット曲線に一致する点を作成します。

アプリケーションは、点を作成し、それらとオフセット曲線の間に一致する制約を追加する必要があります。
- ステップ3 - p\_nodesを作成して固定します。

各一致する制約には関連するヘルプパラメータがあり、アプリケーションはこれらのそれぞれに対してp\_nodeを生成し、それを固定することができます（セクション[7.3.1 ヘルプパラメータの固定](7.3._Help_parameters.md)を参照）
- ステップ4 - 補間曲線を生成します。

アプリケーションは、点を通過する曲線を作成することができます。
この曲線は、アプリケーションが完全にサポートしているタイプ（例：スプライン）である場合に使用することができ、元のパラメトリック曲線の近似オフセットを表現するために使用することができます。
アプリケーションがスプラインを描画するだけであれば、DCMに追加する必要はありません。
そうでなければ、スプライン曲線として追加することができます。

DCMは、点を通過するスプライン曲線を構築するために使用することができます。

さらに、アプリケーションは、正確なオフセット曲線に接線である直線を作成し、これに対して未固定のp\_nodeを生成し、これらのp\_nodeと一致する制約のp\_nodeとの間に等しいパラメータ制約を追加することができます。
（セクション[7.3.2 等しいパラメータ制約](7.3._Help_parameters.md)を参照）

DCMは、点の系列を通過するスプライン曲線を構築することができ、接線および導関数条件も許可します。

なお、上記で説明した方法で生成された近似オフセット曲線と元の曲線の間に距離寸法や等距離制約を配置することはできません。
