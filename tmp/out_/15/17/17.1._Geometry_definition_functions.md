## 17.1 図形定義関数

これらのフラスタム関数は、DCMで使用される解析図形（点、直線、円、楕円、集合）に関する問い合わせを行います。

フラスタム関数がアプリケーションに方向ベクトルの返却を要求する場合、ベクトルの長さが1である必要はありません（つまり、正規化されている必要はありません）。ただし、長さがゼロのベクトルを返すことは無効です。

なお、アプリケーションは、エンティティが作成された後にその種類（図形の種類など）を変更してはなりません。

### 17.1.1 DCM\_g\_identify - 図形のタイプを返す

DCM\_g\_type DCM\_g\_identify( void\* ag );

アプリケーションの図形ポインタを引数にして呼び出され、図形のタイプを返します。
返される可能性のある図形のタイプは以下の通りです：

DCM\_POINT（点）

DCM\_LINE（直線）

DCM\_CIRCLE（円）

DCM\_ELLIPSE（楕円）

DCM\_PARAMETRIC（パラメトリック）

DCM\_SPLINE（スプライン）

DCM\_CONIC（円錐曲線）

DCM\_SCALABLE\_SET（スケーラブルセット）

DCM\_UNI\_SCALABLE\_SET（単一スケーラブルセット）

DCM\_BI\_SCALABLE\_SET（二重スケーラブルセット）

DCM\_SET（セット）

この関数では、DCM\_SPLINEのタイプは返されないようにする必要があります。なぜなら、スプラインのg\_nodesはadd\_g関数を使用して追加されるのではなく、別のインターフェース関数であるadd\_spline\_gを使用して追加されるからです。
同様に、DCM\_CONICはadd\_conic\_g関数を使用して追加する必要があります。

### 17.1.2 DCM\_point\_point - ポイントのベクトルを返す

void DCM\_point\_point( double pt\[2\], void\* ag );

ポイントの座標を返すために、ポイントへのアプリケーションポインタで呼び出されます。

### 17.1.3 DCM\_line\_point - 線上のベクトルを返す

void DCM\_line\_point( double pt\[2\], void\* ag );

この関数は、線のアプリケーションポインタを受け取り、線上の位置の座標を返します。

### 17.1.4 DCM\_line\_direction - 線の方向を返す

void DCM\_line\_direction( double dir\[2\], void\* ag );

アプリケーションポインタを使用して呼び出され、線の方向を返します。

### 17.1.5 DCM\_circle\_center - 円の中心を返す

void DCM\_circle\_center( double pt\[2\], void\* ag );

円のアプリケーションポインタが与えられ、円の中心を返します。

### 17.1.6 DCM\_circle\_radius - 円の半径を返す

void* ag というアプリケーションポインタを使用して円の半径を取得するために呼び出されます。

### 17.1.7 DCM\_circle\_allow\_zero\_radius – 円の半径がゼロであることを許可する

DCM\_allow\_zero\_radius DCM\_circle\_allow\_zero\_radius( void\* ag );

アプリケーションポインタを持つ円で呼び出されます。
アプリケーションは、この円が半径がゼロであることを許可するかどうかを返す必要があります。
返り値は次のいずれかである必要があります：

- DCM\_ALLOW\_ZERO\_RADIUS\_ON – この円の半径はゼロにすることができます。
- DCM\_ALLOW\_ZERO\_RADIUS\_OFF – この円の半径はゼロにすることはできません。
- DCM\_ALLOW\_ZERO\_RADIUS\_DEFAULT – DCMは、円がゼロの半径を持つことができるかどうかを決定するために、円のグローバル設定を使用します。
デフォルトはONであり、つまり円はゼロの半径を持つことができます。
これは、set\_option関数で変更することができます。

この関数が登録されていない場合、常にDCM\_ALLOW\_ZERO\_RADIUS\_DEFAULTを返すことと同等です。

### 17.1.8 DCM\_circle\_allow\_inversion – 円の反転を許可する

DCM\_circle\_allow\_inversion( void\* ag ) は、円に対するアプリケーションポインタを使用して呼び出されます。
アプリケーションは、この円が制約を解決するためにDCMによって反転できるかどうかを返す必要があります。
円の反転は、円に負の半径を与えることと同等です。
返り値は次のいずれかである必要があります：

- DCM\_ALLOW\_CIRCLE\_INVERSION\_ON – 円を反転できます。
- DCM\_ALLOW\_CIRCLE\_INVERSION\_OFF\_STRICT \- DCMはすべての円の反転を拒否します。
ただし、モデルが数値解析を必要とする場合、DCMは円の反転を特定できない場合があります。
- DCM\_ALLOW\_CIRCLE\_INVERSION\_OFF – DCMは「ゼロを通る反転」を拒否しますが、「無限を通る反転」は許可します。
フラスタムは、無限を通る反転が発生した場合に通知しません。

ゼロを通る反転は、制約によって円の半径がゼロになり、その後負の値になる場合に発生します。
半径を負の（つまり不可能な）値に設定する代わりに、DCMは円を反転させ、再びサイズを増やし始めます。

無限を通る反転は、制約によって半径が無限大になり、その時点で円が反転し、半径が減少する場合に発生します。

以下の図は、これらの概念を示しています：

![](../Resources/Images/2ddcm_manual/Geometry definition functions.jpg)

モデルには、固定された直線に接する円があり、円の中心と別の固定された直線の間に距離寸法があります。

距離寸法が減少すると、半径も減少し、ゼロ半径になります。

距離寸法がさらに減少すると、円はゼロを通って反転し、半径が再び増加し始めます。

![](../Resources/Images/2ddcm_manual/Geometry definition functions_1.jpg)

固定された直線と円の点の間に距離寸法が適用されます。
円の他の2つの点は固定されています。

距離寸法が減少すると、点は固定された点の間を移動し、半径は無限に近づきます。

距離寸法がさらに減少すると、円は無限を通って反転し、半径が減少し始めます。

図81：ゼロを通る反転と無限を通る反転

- DCM\_ALLOW\_CIRCLE\_INVERSION\_DEFAULT – DCMは、円のグローバル設定を使用して、この円が反転できるかどうかを決定します。
デフォルトはDCM\_ALLOW\_CIRCLE\_INVERSION\_OFFです。
これは、set\_option関数で変更できます。

この関数が登録されていない場合、常にDCM\_ALLOW\_CIRCLE\_INVERSION\_DEFAULTを返すことと同等です。

### 17.1.9 DCM_ellipse_center - 楕円の中心を返す

void DCM_ellipse_center( double pt[2], void* ag );

楕円へのアプリケーションポインタを使用して呼び出され、楕円の中心の座標（主軸と副軸が交差する点）を返します。

### 17.1.10 DCM_ellipse_direction - 楕円の方向を返す

void DCM_ellipse_direction( double dir[2], void* ag );

楕円のアプリケーションポインタを引数として呼び出され、長軸の方向を返します。

### 17.1.11 DCM_ellipse_major_radius - 楕円の長半径を返す

void* ag というアプリケーションポインタを使って呼び出され、楕円の長半径の値を返します。

### 17.1.12 DCM_ellipse_minor_radius - 楕円の短半径を返す

void* ag に楕円のアプリケーションポインタを指定して呼び出すと、短半径の値を返します。

### 17.1.13 DCM\_scaling\_direction – 一次および二次スケーラブルセットの定義

DCM\_scaling\_direction\_return DCM\_scaling\_direction(void\* ag, double dir\[2\]);

アプリケーションポインタを使用して、一次または二次スケーラブルセットを指定して呼び出されます。
この関数は、二次元ベクトルとしての方向を返します。
このリリースでは、DCM\_SCALING\_DIRECTION\_SPECIFIEDという1つの返り値のみがあります。
二次スケーラブルセットの場合、これは最初のスケーリング方向です。
2つ目のスケールは常にこの方向に直交するため、2つ目のベクトルは必要ありません。

スケーラブルセットが評価の結果として回転する場合、スケーリング方向も新しい方向に合わせて回転されます。
例えば、セットがx方向にスケーリング方向を持っていて、評価の結果として90度回転する場合、セットはy方向にスケーリングできるようになります。

スケーリング方向は、2D DCM内の指向性ジオメトリの方向から派生することがよくあります。
また、指向性ジオメトリと共有されない方向である場合もあります。例えば、(0,1)や(1,0)です。

スケーリング方向は、アプリケーションによってフラスタムインターフェースを介して評価ごとに提供されます。
スケーリング方向が一次スケーラブルセット内の指向性ジオメトリから派生していない場合、アプリケーションは一次スケーラブルセットの回転に合わせて提供されるスケーリング方向が一貫していることを確認する必要があります。
例えば、一次スケーラブルセットの初期スケーリング方向が(1,0)であり、90度回転する場合、次の評価時にスケーリング方向が(0,1)であることをアプリケーションは確保する必要があります。

1.1.1 この関数は、剛性がDCM\_BS\_RIGIDITY\_UNI\_SCALABLEまたはDCM\_BS\_RIGIDITY\_BII\_SCALABLEに設定されたスプライン曲線には適用されません。アプリケーションは、スプラインに対してスケーリング方向をDCM\_bs\_data構造体を介して指定する必要があります（[16.6.1 DCM\_bs\_data – スプラインデータ構造体](16.6._Spline_functions.md)を参照）。
